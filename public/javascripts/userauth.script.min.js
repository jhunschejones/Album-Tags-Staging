function hideDOMelement(elementId){try{var element=document.getElementById(elementId);try{element.style.display="none"}catch(error){function logError(){var newKey=firebase.database().ref().child("errors").push().key;firebase.database().ref("errors/"+newKey).update({error:{elementId:elementId,User:userID,URL:window.location.href,Date_Time:(new Date).toLocaleString(),Error:JSON.stringify(error,Object.getOwnPropertyNames(error))}})}logError()}}catch(error){}}function showDOMelement(elementId){try{var element=document.getElementById(elementId);try{element.style.display="block"}catch(error){function logError(){var newKey=firebase.database().ref().child("errors").push().key;firebase.database().ref("errors/"+newKey).update({error:{elementId:elementId,User:userID,URL:window.location.href,Date_Time:(new Date).toLocaleString(),Error:JSON.stringify(error,Object.getOwnPropertyNames(error))}})}logError()}}catch(error){}}console.log("The custom script for the userauth page is running");var config={apiKey:"AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",authDomain:"album-tag-auth.firebaseapp.com",databaseURL:"https://album-tag-auth.firebaseio.com/",projectId:"album-tag-auth",storageBucket:"album-tag-auth.appspot.com",messagingSenderId:"1048555394172"};const defaultApp=firebase.initializeApp(config),connectionsApp=firebase.initializeApp({apiKey:"AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",databaseURL:"https://album-tag-connections.firebaseio.com/",projectId:"album-tag-auth"},"app2"),favoritesApp=firebase.initializeApp({apiKey:"AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",databaseURL:"https://album-tag-favorites.firebaseio.com/",projectId:"album-tag-auth"},"app3"),connectionsDatabase=firebase.database(connectionsApp),favoritesDatabase=firebase.database(favoritesApp);var loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button"),logInMessage=document.getElementById("log_in_message"),loader=document.getElementById("loader"),userEmail="",userName="",user=firebase.auth().currentUser,userID,dbRefrence;function signInFunctionality(user){$(".hide_when_logged_in").addClass("hide_me"),$(".hide_when_logged_out").removeClass("hide_me"),showDOMelement("full_menu_login_logout_container"),userEmail=user.email,userName=user.displayName,userID=user.uid;try{updateFavoriteAlbums()}catch(error){}try{updateConnectedAlbums()}catch(error){}try{populateUserData()}catch(error){}try{populateTags("start")}catch(error){}const allowedUsers=["joshjones103@gmail.com","znoffy5@gmail.com","devon.curry891@gmail.com","milesjohnsonmusic@gmail.com","austinhuelsbeck@gmail.com"];var whatTagsToShow,whatConnectionsToShow,whatTagsToShow,whatConnectionsToShow;allowedUsers.indexOf(userEmail)>-1?(tagUpdatePermissionsGranted(),"My Tags"==(whatTagsToShow=sessionStorage.getItem("tags"))||null==whatTagsToShow?(sessionStorage.setItem("tags","My Tags"),filterDisplayedTags()):"All Tags"==whatTagsToShow&&(sessionStorage.setItem("tags","All Tags"),allTagsNoFilter()),"My Connections"==(whatConnectionsToShow=sessionStorage.getItem("connections"))||null==whatConnectionsToShow?(sessionStorage.setItem("connections","My Connections"),filterDisplayedConnections()):"All Connections"==whatConnectionsToShow&&(sessionStorage.setItem("connections","All Connections"),allConnectionsNoFilter())):(tagUpdatePermissionsGranted(),"My Tags"==(whatTagsToShow=sessionStorage.getItem("tags"))||null==whatTagsToShow?(sessionStorage.setItem("tags","My Tags"),filterDisplayedTags()):"All Tags"==whatTagsToShow&&(sessionStorage.setItem("tags","All Tags"),allTagsNoFilter()),"My Connections"==(whatConnectionsToShow=sessionStorage.getItem("connections"))||null==whatConnectionsToShow?(sessionStorage.setItem("connections","My Connections"),filterDisplayedConnections()):"All Connections"==whatConnectionsToShow&&(sessionStorage.setItem("connections","All Connections"),allConnectionsNoFilter()))}var sessionId=JSON.parse(sessionStorage.getItem("sessionId")),sessionLogin=!1;function noUserSignedIn(){try{logInMessage.innerHTML='<div class="container-fluid please_log_in"><p class="text-danger">Please sign in to access this feature</p> <button onclick="logIn()" class="btn btn-danger" id="login_link">Log In</button></div>'}catch(error){}hideDOMelement("loader"),$(".hide_when_logged_in").removeClass("hide_me"),$(".hide_when_logged_out").addClass("hide_me"),showDOMelement("full_menu_login_logout_container");try{populateSearchedTags()}catch(error){}}function tagUpdatePermissionsGranted(){var whatTagsToShow=sessionStorage.getItem("tags");"My Tags"!=whatTagsToShow&"All Tags"!=whatTagsToShow&&sessionStorage.setItem("tags","My Tags"),$("#update_button_container").html('<a href="" onclick="goToUpdatePage()" class="btn btn-sm btn-outline-secondary update_button hide_when_logged_out">Update<span class="button_text"> Tags</span></a>'),$("#tags_toggle").html('<img src="/images/toggle_off.png" id="show_only_my_tags" class="hide_when_logged_out" style="height:22px;margin-left:10px;" onclick="showAllTags()" data-toggle="tooltip" data-placement="right" title="Show All Tags" data-trigger="hover"><img src="/images/toggle_on.png" class="hide_when_logged_out" id="show_all_tags" style="height:22px;margin-left:10px;" onclick="showOnlyMyTags()" data-toggle="tooltip" data-placement="right" title="Only Show My Tags" data-trigger="hover">'),$("#connections_toggle").html('<img src="/images/toggle_off.png" id="show_only_my_connections" class="hide_when_logged_out" style="height:22px;margin-left:10px;" onclick="showAllConnections()" data-toggle="tooltip" data-placement="right" title="Show All Connections" data-trigger="hover"><img src="/images/toggle_on.png" class="hide_when_logged_out" id="show_all_connections" style="height:22px;margin-left:10px;" onclick="showOnlyMyConnections()" data-toggle="tooltip" data-placement="right" title="Only Show My Connections" data-trigger="hover">'),$("#connection_button_container").html('<a href="" onclick="goToUpdatePage()" class="btn btn-sm btn-outline-secondary update_button hide_when_logged_out">Update Connections</a>');try{logInMessage.innerHTML=""}catch(error){}try{checkUserDisplayPrefrences()}catch(error){}}function filterDisplayedTags(){try{var anyTagsOnPage=!1;tagsForThisAlbum=$(".album_details_tags");for(var index=0;index<tagsForThisAlbum.length;index++){var thisTag=tagsForThisAlbum[index];$(thisTag).hasClass("author-"+userID)?($(thisTag).show(),anyTagsOnPage=!0):$(thisTag).hide()}1==anyTagsOnPage?($(".tag_search_button").show(),$("#tag_results").show(),$("#tag_results_message").html("")):($(".tag_search_button").hide(),$("#tag_results").hide(),$("#tag_results_message").html('<small class="text-primary">You currently have no tags for this album!</small>'))}catch(error){}}function allTagsNoFilter(){try{var anyTagsOnPage=!1;if(tagsForThisAlbum=$(".album_details_tags"),tagsForThisAlbum.length>0){anyTagsOnPage=!0;for(var index=0;index<tagsForThisAlbum.length;index++){var thisTag=tagsForThisAlbum[index];$(thisTag).show()}}1==anyTagsOnPage?($(".tag_search_button").show(),$("#tag_results").show(),$("#tag_results_message").html("")):($(".tag_search_button").hide(),$("#tag_results").hide(),$("#tag_results_message").html('<small class="text-primary">There are currently no tags for this album!</small>'))}catch(error){}}function filterDisplayedConnections(){try{var anyConnectionsOnPage=!1;connectionsForThisAlbum=$(".connection");for(var index=0;index<connectionsForThisAlbum.length;index++){var connection=connectionsForThisAlbum[index];$(connection).hasClass("author-"+userID)?($(connection).show(),anyConnectionsOnPage=!0):$(connection).hide()}1==anyConnectionsOnPage?($("#connection_results").show(),$("#connection_results_message").html("")):($("#connection_results").hide(),$("#connection_results_message").html('<small class="text-primary">You currently have no connections for this album!</small>'))}catch(error){}}function allConnectionsNoFilter(){try{var anyConnectionsOnPage=!1;if(connectionsForThisAlbum=$(".connection"),connectionsForThisAlbum.length>0){anyConnectionsOnPage=!0;for(var index=0;index<connectionsForThisAlbum.length;index++){var thisConnection=connectionsForThisAlbum[index];$(thisConnection).show()}}1==anyConnectionsOnPage?($("#connection_results").show(),$("#connection_results_message").html("")):($("#connection_results").show(),$("#connection_results_message").html('<small class="text-primary">There are currently no connections for this album!</small>'))}catch(error){}}function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var provider=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(provider)}).then(function(result){var token=result.credential.accessToken;userEmail=result.user.email}).catch(function(error){var errorCode=error.code,errorMessage=error.message,email=error.email,credential=error.credential})}function goToUpdatePage(){event.preventDefault();var url=window.location.href;url=url.replace("albumdetails","update"),window.location=url}function logOut(){firebase.auth().signOut().then(function(){storage.removeItem("sessionId"),noUserSignedIn()}).catch(function(error){})}null!=sessionId&&(sessionLogin=!0,console.log("Session storage login"),signInFunctionality(sessionId)),firebase.auth().onAuthStateChanged(function(user){!1===sessionLogin&&(user?(sessionStorage.setItem("sessionId",JSON.stringify(user)),console.log("Firebase login"),signInFunctionality(user)):noUserSignedIn())}),loginButton.addEventListener("click",logIn),loginButton2.addEventListener("click",logIn),logoutButton.addEventListener("click",logOut),logoutButton2.addEventListener("click",logOut);