function truncate(a,c){a=a.substr(0,c-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}function removeDash(a){return a.replace(/-/g,"")}function bubbleSort(a,c){do{var b=!1;for(var d=0;d<a.length-1;d++)parseInt(removeDash(a[d][c]))<parseInt(removeDash(a[d+1][c]))&&(b=a[d],a[d]=a[d+1],a[d+1]=b,b=!0)}while(b)}var myFavoriteAlbums;
function createCard(a){$("#favorites_all_cards").append('<div id="card'+a+'" class="card albumCard"><a class="album_details_link" href=""><img class="card-img-top" src="" alt=""><a/><div class="card-body"><h4 class="card-title"></h4><span class="album"><span class="text-primary">Loading Album Details...</span></span></div></div>')}
function populateCard(a,c){var b=(new URL(document.location)).searchParams.get("year");if(a.releaseDate.slice(0,4)!=""+(b||(new Date).getFullYear()))document.getElementById("card"+c).remove();else{var d=b=a.artist,e=a.title,f=a.title;32<b.length&&(b=truncate(b,32));44<e.length&&(e=truncate(e,44));49<d.length&&(d=truncate(d,49));66<f.length&&(f=truncate(f,66));$("#card"+c+" .card-body h4").html('<span class="large_artist">'+d+'</span><span class="small_artist">'+b+"</span>");$("#card"+c+" .card-body .album").html('<span class="large_album">'+
f+'</span><span class="small_album">'+e+"</span>");$("#card"+c+" img").attr("src",a.cover.replace("{w}",260).replace("{h}",260));$("#card"+c+" .album_details_link").attr("href","/album/"+a.appleAlbumID)}}function getFavoriteAlbums(){$.ajax({method:"GET",url:"/api/v1/album/favorites/Ol5d5mjWi9eQ7HoANLhM4OFBnso2",success:function(a){myFavoriteAlbums=a;startFavoritesPage()}})}var allYears=[];
function addToYears(a){a=a.releaseDate.slice(0,4);-1==allYears.indexOf(a)&&($(".year-dropdown").append('<a class="dropdown-item release-year" data-release="'+a+'" href="">'+a+"</a>"),allYears.push(a))}
function startFavoritesPage(){$("#favorites_all_cards").html("");$(".year-dropdown").html("");allYears=[];bubbleSort(myFavoriteAlbums,"releaseDate");for(var a=0;a<myFavoriteAlbums.length;a++){var c=myFavoriteAlbums[a],b=a+1;createCard(b);populateCard(c,b);addToYears(c)}$(".release-year").on("click",function(a){var b=$(this).attr("data-release");history.pushState({},"","/favorites?year="+b);$(".year-dropdown-button").text(b);document.title="Album Tags : "+b;startFavoritesPage();a.preventDefault()});
0===$("#favorites_all_cards")[0].childElementCount&&(a=(new URL(document.location)).searchParams.get("year"),"/favorites"!=(new URL(document.location)).pathname||(new URL(document.location)).searchParams.get("year")||(a=(new Date).getFullYear()),""==(new URL(document.location)).searchParams.get("year")&&(a="blank"),$("#favorites_all_cards").html('<div class="col" style="text-align:center;margin-top:100px;margin-bottom:100px;"><p class="text-danger">Sorry, we don\'t have any favorite albums from year "'+
(a||"blank")+'." Try a different year from the dropdown!</p></div>'))}getFavoriteAlbums();var dropdownYear='<div class="dropdown" style="display:inline;"><a class="dropdown-toggle text-secondary year-dropdown-button" href="" role="button" id="dropdownYearLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">'+((new URL(document.location)).searchParams.get("year")||(new Date).getFullYear())+'</a><div class="year-dropdown dropdown-menu" aria-labelledby="dropdownYearLink" style="max-height:41vh;overflow-y:scroll;"></div></div>';
$(".subtitle").html("Our Favorite Albums of <span>"+dropdownYear+"</span>");$(document).on("scroll",function(){$(".year-dropdown").removeClass("show")});$(document).ready(function(a){a(window).on("popstate",function(){startFavoritesPage();a(".year-dropdown-button").text(""+((new URL(document.location)).searchParams.get("year")||(new Date).getFullYear()))})});
