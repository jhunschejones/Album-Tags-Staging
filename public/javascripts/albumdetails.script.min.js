function scrollToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function hideDOMelement(elementId){try{let element;document.getElementById(elementId).style.display="none"}catch(error){}}function showDOMelement(elementId){try{let element;document.getElementById(elementId).style.display="block"}catch(error){}}function toggleDOMelement(content){let query=$(`#${content}`);var isVisible;!0===query.is(":visible")?query.hide():query.show()}function toggleContentAndArrows(content,up,down){let query=$(`#${content}`),downArrow=$(`#${down}`),upArrow=$(`#${up}`);var isVisible;!0===query.is(":visible")?(query.css("display","none"),downArrow.css("display","block"),upArrow.css("display","none")):(query.css("display","block"),downArrow.css("display","none"),upArrow.css("display","block"))}function toggleTracksAndArrows(content,up,down){let query=$(`#${content}`),downArrow=$(`#${down}`),upArrow=$(`#${up}`);var isVisible;!0===query.is(":visible")?(query.css("display","none"),downArrow.css("display","inline-block"),upArrow.css("display","none")):(query.css("display","inline-block"),downArrow.css("display","none"),upArrow.css("display","inline-block"))}function countInArray(array,item){for(var count=0,i=0;i<array.length;i++)array[i]===item&&count++;return count}function safeParse(content){return content=content.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\//g,"&#47;").replace(/\\/g,"&#92;").replace(/\(/g,"&#40;").replace(/\)/,"&#41;").replace(/\./g,"&#46;").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/\{/g,"&#123;").replace(/\}/g,"&#125;").replace(/\=/g,"&#61;")}function replaceBackSlashWithHtml(str){return str.replace(/\//g,"&sol;")}const albumId=window.location.pathname.replace("/albumdetails/","");let tagsForThisAlbum,albumResult;function getAlbumDetails(albumNumber){$.getJSON("/api/v1/album/albumid/"+albumNumber,function(album){return album.message?void $.getJSON("/api/v1/apple/details/"+albumNumber,function(album){albumResult=album,populateAlbumDetails(album)}):(albumResult=album,void populateAlbumDetails(album))})}function populateAlbumDetails(album){var artist=album.artist,title=album.title,label=album.recordCompany,cover=album.cover.replace("{w}",450).replace("{h}",450),applemusicurl=album.appleURL,release=makeNiceDate(album.releaseDate),songNames=album.songNames;$(".albumdetails_details img").attr("src",cover,"<br"),$(".albumdetails_artist").append(`<span onclick="moreByThisArtist('${artist}')" data-toggle="tooltip" data-placement="right" title="Search This Artist" data-trigger="hover" style="cursor:pointer;">${artist}</span>`),$(".albumdetails_artist").append('<span id="add-tag-button" data-toggle="tooltip" data-placement="right" title="Go to the update page to add to favorites" data-trigger="hover">&#43;</span>'),$(".albumdetails_album").append(`<span id="the_album_name" data-toggle="tooltip" data-placement="right" title="Click to Show Album ID" data-trigger="hover" onclick="showAlbumID()" style="cursor:pointer;">${title}</span><span id="the_album_id" class="text-secondary" data-toggle="tooltip" data-placement="right" title="Select & Copy Album ID" data-trigger="hover" style="display:none;">${album.appleAlbumID}</span>`),$(".applemusicurl").attr("href",applemusicurl,"<br>"),$(".albumdetails_label").append(label,"<br>"),$(".albumdetails_release").append(release,"<br>"),songNames.forEach(element=>{$(".song_names").append(`<li>${element}</li>`)}),populateTags(album.appleAlbumID),document.getElementById("add-tag-button").addEventListener("click",goToUpdatePage)}function showAlbumID(){$("#the_album_id").tooltip("disable"),showDOMelement("the_album_id"),hideDOMelement("the_album_name"),setTimeout(showAlbumName,7e3)}function showAlbumName(){$("#the_album_name").tooltip("disable"),showDOMelement("the_album_name"),hideDOMelement("the_album_id")}const months=["January","February","March","April","May","June","July","August","September","October","November","December"];function makeNiceDate(uglyDate){let year=uglyDate.slice(0,4),day=uglyDate.slice(8,10),uglyMonth=uglyDate.slice(5,7),niceMonth;return`${months[uglyMonth-1]} ${day}, ${year}`}function replaceUnderscoreWithBackSlash(str){return str.replace(/_/g,"/")}function populateTags(albumNumber){if("start"!==albumNumber){var noAuthors=!1;if($("#tags_toggle").html('<img src="/images/toggle_off.png" id="show_only_my_tags" class="hide_when_logged_out" style="height:22px;margin-left:10px;" onclick="showAllTags()" data-toggle="tooltip" data-placement="right" title="Show All Tags" data-trigger="hover"><img src="/images/toggle_on.png" class="hide_when_logged_out" id="show_all_tags" style="height:22px;margin-left:10px;" onclick="showOnlyMyTags()" data-toggle="tooltip" data-placement="right" title="Only Show My Tags" data-trigger="hover">'),checkUserDisplayPrefrences(),albumResult.tagObjects&&albumResult.tagObjects.length>0){$(".tag_results").text(""),$(".tag_search_button").html('<a href="" onclick="tagSearch()" class="btn btn-sm btn-outline-secondary tag_search_button hide_when_logged_out" style="display:none;">Search<span class="button_text"> by Selected Tags</span></a>'),currentTags=[],currentAuthors=[];for(let index=0;index<albumResult.tagObjects.length;index++){let tag=albumResult.tagObjects[index].tag;const author=albumResult.tagObjects[index].creator;if(parseInt(tag))var addLetters="tag_",tagName="tag_".concat(tag).replace(/[^A-Z0-9]+/gi,"");else var tagName=tag.replace(/[^A-Z0-9]+/gi,"");$(".tag_results").append(`<a href="" onclick="changeClass(${tagName}, event)" id="${tagName}" class="badge badge-light album_details_tags author-${author}">${safeParse(tag)}</a>  `)}$(".album_details_tags").hide()}putConnectionsOnPage()}}function changeClass(tagName,event){event&&event.preventDefault(),$(".warning_label").text("");var thisTag=document.getElementById(tagName.id);thisTag.classList.toggle("badge-primary"),thisTag.classList.toggle("selected_tag"),thisTag.classList.toggle("badge-light"),addToTagArray(replaceBackSlashWithHtml(thisTag.innerHTML))}var selectedTags=[];function addToTagArray(tag){if(-1===$.inArray(tag,selectedTags))selectedTags.push(tag);else{let index=selectedTags.indexOf(tag);selectedTags.splice(index,1)}}function putConnectionsOnPage(){$(".connection_results").text(""),$("#connections_toggle").html('<img src="/images/toggle_off.png" id="show_only_my_connections" class="hide_when_logged_out" style="height:22px;margin-left:10px;" onclick="showAllConnections()" data-toggle="tooltip" data-placement="right" title="Show All Connections" data-trigger="hover"><img src="/images/toggle_on.png" class="hide_when_logged_out" id="show_all_connections" style="height:22px;margin-left:10px;" onclick="showOnlyMyConnections()" data-toggle="tooltip" data-placement="right" title="Only Show My Connections" data-trigger="hover">');let directConnections=[];if(albumResult.connectionObjects&&albumResult.connectionObjects.length>0){for(let index=0;index<albumResult.connectionObjects.length;index++){let connectedAlbum=albumResult.connectionObjects[index];if(directConnections.push(connectedAlbum.appleAlbumID),connectedAlbum.appleAlbumID!=albumResult.appleAlbumID){var cover=connectedAlbum.cover.replace("{w}",105).replace("{h}",105);$(".connection_results").append(`<a href="/albumdetails/${connectedAlbum.appleAlbumID}" id="${connectedAlbum.appleAlbumID}" class="connection author-${connectedAlbum.creator}"><img class="small_cover" src="${cover}" data-toggle="tooltip" data-placement="top" title="Album Details" data-trigger="hover"></a>`)}}checkConnectionDisplayPrefrences()}else checkConnectionDisplayPrefrences()}function showAllTags(event){event&&event.preventDefault(),allTagsNoFilter(),$("#show_all_tags").show(),$("#show_only_my_tags").hide(),$("#tags_modifier").html("All "),sessionStorage.setItem("tags","All Tags"),clearTagArray()}function showOnlyMyTags(event){event&&event.preventDefault(),filterDisplayedTags(),$("#show_all_tags").hide(),$("#show_only_my_tags").show(),$("#tags_modifier").html("My "),sessionStorage.setItem("tags","My Tags"),clearTagArray()}function clearTagArray(event){event&&event.preventDefault(),$(".warning_label").html(""),$(".selected_tag").length>0&&($(".selected_tag").toggleClass("badge-primary"),$(".selected_tag").toggleClass("badge-light"),$(".selected_tag").toggleClass("selected_tag"),selectedTags=[])}function deDupAllTags(){let allAlbumTags=$(".album_details_tags"),thisAuthor=[],thisAuthorId=[],otherAuthor=[],otherAuthorId=[];for(let index=0;index<allAlbumTags.length;index++){let elementId=allAlbumTags[index].id,element=allAlbumTags[index];1==element.classList.contains(`author-${userID}`)?(thisAuthor.push(element),thisAuthorId.push(elementId)):(otherAuthor.push(element),otherAuthorId.push(elementId))}for(let index=0;index<otherAuthor.length;index++){let element=otherAuthor[index],elementId=otherAuthorId[index];-1!=thisAuthorId.indexOf(elementId)&&(element.remove(),otherAuthor.splice(index,1),otherAuthorId.splice(index,1))}for(let index=0;index<otherAuthor.length;index++){let element=otherAuthor[index],elementId;countInArray(otherAuthorId,otherAuthorId[index])>1&&(element.remove(),otherAuthor.splice(index,1),otherAuthorId.splice(index,1))}}function deDupAllConnections(){let allAlbumConnections=$(".connection"),thisAuthor=[],thisAuthorId=[],otherAuthor=[],otherAuthorId=[];for(let index=0;index<allAlbumConnections.length;index++){let element=allAlbumConnections[index],elementId=allAlbumConnections[index].id;1==element.classList.contains(`author-${userID}`)?(thisAuthor.push(element),thisAuthorId.push(elementId)):(otherAuthor.push(element),otherAuthorId.push(elementId))}for(let index=0;index<otherAuthor.length;index++){let element=otherAuthor[index],elementId=otherAuthorId[index];-1!=thisAuthorId.indexOf(elementId)&&(element.remove(),otherAuthor.splice(index,1),otherAuthorId.splice(index,1))}for(let index=0;index<otherAuthor.length;index++){let element=otherAuthor[index],elementId;countInArray(otherAuthorId,otherAuthorId[index])>1&&(element.remove(),otherAuthor.splice(index,1),otherAuthorId.splice(index,1))}}function showAllConnections(){allConnectionsNoFilter(),$("#show_all_connections").show(),$("#show_only_my_connections").hide(),$("#connections_modifier").html("All "),sessionStorage.setItem("connections","All Connections")}function showOnlyMyConnections(){filterDisplayedConnections(),$("#show_all_connections").hide(),$("#show_only_my_connections").show(),$("#connections_modifier").html("My "),sessionStorage.setItem("connections","My Connections")}function checkUserDisplayPrefrences(){var whatTagsToShow=sessionStorage.getItem("tags");deDupAllTags(),"My Tags"==whatTagsToShow?($("#show_all_tags").hide(),$("#tags_modifier").html("My ")):"All Tags"!=whatTagsToShow&&null!=whatTagsToShow||($("#show_only_my_tags").hide(),$("#tags_modifier").html("All "),showAllTags())}function checkConnectionDisplayPrefrences(){$("#connections_card").show();var whatConnectionsToShow=sessionStorage.getItem("connections");deDupAllConnections(),"My Connections"==whatConnectionsToShow?($("#show_all_connections").hide(),$("#connections_modifier").html("My "),showOnlyMyConnections()):"All Connections"!=whatConnectionsToShow&&null!=whatConnectionsToShow||($("#show_only_my_connections").hide(),$("#connections_modifier").html("All "),showAllConnections())}function tagSearch(event){if(event&&event.preventDefault(),selectedTags.length>0)var win=window.location=`/search/tags/${selectedTags}`;else $(".warning_label").html(""),$(".warning_label").html("<br/>Select one or more tags to preform a tag-search.")}function moreByThisArtist(artist){sessionStorage.setItem("artist",artist),window.location.href="/search"}function scrollDown(){1==isTouchDevice&screen.width<570&&window.scrollTo(0,document.body.scrollHeight)}function filterDisplayedTags(){var anyTagsOnPage=!1;tagsForThisAlbum=$(".album_details_tags");for(var index=0;index<tagsForThisAlbum.length;index++){var thisTag=tagsForThisAlbum[index];$(thisTag).hasClass("author-"+userID)?($(thisTag).show(),anyTagsOnPage=!0):$(thisTag).hide()}1==anyTagsOnPage?($(".tag_search_button").show(),$("#tag_results").show(),$("#tag_results_message").html("")):($(".tag_search_button").hide(),$("#tag_results").hide(),$("#tag_results_message").html('<small class="text-primary">You currently have no tags for this album!</small>'))}function allTagsNoFilter(){var anyTagsOnPage=!1;if((tagsForThisAlbum=$(".album_details_tags")).length>0){anyTagsOnPage=!0;for(var index=0;index<tagsForThisAlbum.length;index++){var thisTag=tagsForThisAlbum[index];$(thisTag).show()}}1==anyTagsOnPage?($(".tag_search_button").show(),$("#tag_results").show(),$("#tag_results_message").html("")):($(".tag_search_button").hide(),$("#tag_results").hide(),$("#tag_results_message").html('<small class="text-primary">There are currently no tags for this album!</small>'))}function filterDisplayedConnections(){var anyConnectionsOnPage=!1;connectionsForThisAlbum=$(".connection");for(var index=0;index<connectionsForThisAlbum.length;index++){var connection=connectionsForThisAlbum[index];$(connection).hasClass("author-"+userID)?($(connection).show(),anyConnectionsOnPage=!0):($(connection).hide(),anyConnectionsOnPage=!1)}1==anyConnectionsOnPage?($("#connection_results").show(),$("#connection_results_message").html(""),$("#connection_results_message").hide()):($("#connection_results").hide(),$("#connection_results_message").show(),$("#connection_results_message").html('<small class="text-primary">You currently have no connections for this album!</small>'))}function allConnectionsNoFilter(){var anyConnectionsOnPage=!1;if(connectionsForThisAlbum=$(".connection"),connectionsForThisAlbum.length>0){anyConnectionsOnPage=!0;for(var index=0;index<connectionsForThisAlbum.length;index++){var thisConnection=connectionsForThisAlbum[index];$(thisConnection).show()}}1==anyConnectionsOnPage?($("#connection_results").show(),$("#connection_results_message").html(""),$("#connection_results_message").hide()):($("#connection_results").show(),$("#connection_results_message").show(),$("#connection_results_message").html('<small class="text-primary">There are currently no connections for this album!</small>'))}function goToUpdatePage(event){event&&event.preventDefault();var url=window.location.href;url=url.replace("albumdetails","update"),window.location=url}var isTouchDevice=!1;function userIsLoggedIn(){$(".hide_when_logged_in").addClass("hide_me"),$(".hide_when_logged_out").removeClass("hide_me"),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show(),$("#update_button_container").html('<a href="" onclick="goToUpdatePage()" class="btn btn-sm btn-outline-secondary update_button hide_when_logged_out">Update<span class="button_text"> Tags</span></a>'),$("#connection_button_container").html('<a href="" onclick="goToUpdatePage()" class="btn btn-sm btn-outline-secondary update_button hide_when_logged_out">Update Connections</a>'),$("#connections_card").show();var whatTagsToShow=sessionStorage.getItem("tags");"My Tags"==whatTagsToShow?(sessionStorage.setItem("tags","My Tags"),filterDisplayedTags()):whatTagsToShow&&"All Tags"!=whatTagsToShow&&null!=whatTagsToShow||(sessionStorage.setItem("tags","All Tags"),allTagsNoFilter());var whatConnectionsToShow=sessionStorage.getItem("connections");"My Connections"==whatConnectionsToShow?(sessionStorage.setItem("connections","My Connections"),filterDisplayedConnections()):whatConnectionsToShow&&"All Connections"!=whatConnectionsToShow&&null!=whatConnectionsToShow||(sessionStorage.setItem("connections","All Connections"),allConnectionsNoFilter()),$("#connections_toggle").show(),$("#tags_toggle").show(),$(".update_button").show()}function userIsLoggedOut(){$(".hide_when_logged_out").addClass("hide_me"),$(".hide_when_logged_in").removeClass("hide_me"),$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide(),showAllTags(),showAllConnections(),$("#connections_toggle").hide(),$("#tags_toggle").hide(),$(".update_button").hide()}$(function(){setTimeout(function(){"ontouchstart"in document.documentElement&&(isTouchDevice=!0),0==isTouchDevice&&$('[data-toggle="tooltip"]').tooltip()},1e3)});const config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config);let userID;function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var provider=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(provider)}).then(function(result){userID=user.uid,userIsLoggedIn()}).catch(function(error){})}function logOut(){firebase.auth().signOut().then(function(){userIsLoggedOut()}).catch(function(error){})}firebase.auth().onAuthStateChanged(function(user){user&&(userID=firebase.auth().currentUser.uid,userIsLoggedIn()),user||userIsLoggedOut()});const loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button");loginButton.addEventListener("click",logIn),loginButton2.addEventListener("click",logIn),logoutButton.addEventListener("click",logOut),logoutButton2.addEventListener("click",logOut),getAlbumDetails(albumId);