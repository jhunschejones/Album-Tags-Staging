var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");function scrollToTop(){document.body.scrollTop=0;document.documentElement.scrollTop=0}
function hideDOMelement(a){try{document.getElementById(a).style.display="none"}catch(b){}}function showDOMelement(a){try{document.getElementById(a).style.display="block"}catch(b){}}function replaceUnderscoreWithBackSlash(a){return a.replace(/_/g,"/")}function replaceSpaceWithUnderscore(a){return a.replace(/ /g,"_")}function replaceSepecialCharacters(a){return a.replace(/[^\w\s]/gi,"")}function removeDash(a){return a.replace(/-/g,"")}function removeDoubleSpace(a){return a.replace(/\s\s+/g," ")}
function isGenre(a){return-1!="Metalcore;Pop Punk;Emo;Rock;Post-Hardcore;Accoustic;Screamo;Metal;Nu Metal;Alt Metal;Djent".split(";").indexOf(a)?!0:!1}function removeDuplicates(a){for(var b=[],c=0;c<a.length;c++)-1==b.indexOf(a[c])&&b.push(a[c]);return b}function removeElementFromArray(a,b){-1!=a.indexOf(b)&&a.splice(a.indexOf(b),1)}function truncate(a,b){a=a.substr(0,b-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}
function truncatePlain(a,b){a=a.substr(0,b-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")}function bubbleSort(a,b){do{var c=!1;for(var d=0;d<a.length-1;d++)parseInt(removeDash(a[d][b]))>parseInt(removeDash(a[d+1][b]))&&(c=a[d],a[d]=a[d+1],a[d+1]=c,c=!0)}while(c)}
function addInfoButtons(){$("#compact_menu p").width("80%");$(".my_dropdown").css("margin-top","-2px");$("#compact_menu p").append('<span class="text-secondary ml-2 float-right page-info-button" style="cursor:pointer;" data-toggle="modal" data-target="#pageInfoModal">&#9432;</span>');$("#all-favorites-filters").append('<button class="btn btn-sm btn-light sticky-top float-left button_text ml-1" style="cursor:pointer;margin-top:2px;" data-toggle="modal" data-target="#addFavoritesAlbumModal">Add Album</button>');
$("#all-favorites-filters").append('<button class="btn btn-sm btn-light sticky-top float-left button_text ml-1" style="cursor:pointer;margin-top:2px;" data-toggle="modal" data-target="#pageInfoModal">&#9432;</button>')}addInfoButtons();$(".add-album-instruction-link").click(function(a){a.preventDefault();$("#pageInfoModal").modal("hide");$("#addFavoritesAlbumModal").modal("show")});
function createCard(a,b){$("#all_cards").append('<div id="card'+b+'" class="card albumCard"><a class="album_details_link" href=""><img class="card-img-top" src="" alt=""><a/><span class="remove-favorite-button" data-album-id="'+a._id+'">&#10005;</span><div class="card-body"><h4 class="card-title"></h4><span class="album"><span class="text-primary">Loading Album Details...</span></span></div></div>')}
function populateCard(a,b){var c=a.artist,d=a.artist,e=a.title,f=a.title;32<c.length&&(c=truncate(c,32));44<e.length&&(e=truncate(e,44));49<d.length&&(d=truncate(d,49));66<f.length&&(f=truncate(f,66));$("#card"+b+" .card-body h4").html('<span class="large_artist">'+d+'</span><span class="small_artist">'+c+"</span>");$("#card"+b+" .card-body .album").html('<span class="large_album">'+f+'</span><span class="small_album">'+e+"</span>");$("#card"+b).addClass("year-"+a.releaseDate.slice(0,4));$("#card"+
b).addClass("artist-"+replaceSpaceWithUnderscore(removeDoubleSpace(replaceSepecialCharacters(a.artist))));for(c=0;c<a.genres.length;c++)d=a.genres[c],-1==notMyGenres.indexOf(d)&&$("#card"+b).addClass("genre-"+replaceSpaceWithUnderscore(replaceSepecialCharacters(d)));$("#card"+b+" img").attr("src",a.cover.replace("{w}",260).replace("{h}",260));$("#card"+b+" .album_details_link").attr("href","/album/"+a.appleAlbumID);yearsList.push(""+a.releaseDate.slice(0,4));appleGenreList.push(a.genres);artistsList.push(a.artist)}
document.getElementById("share-favorites-button").addEventListener("click",function(){$("#shareFavoritesModal").modal("show")});
document.getElementById("get-shareable-link").addEventListener("click",function(){var a=$("#display-name-input").val();$.ajax("/api/v1/list/favorites/"+userID,{method:"POST",contentType:"application/json",data:JSON.stringify({displayName:a}),success:function(a){a=window.location.protocol+"//"+window.location.host+"/list/"+a;var c=document.getElementById("shareable-url");c.value=a;c.select();navigator.clipboard.writeText(a).then(function(){$("#copied-message").show();setTimeout(function(){$("#copied-message").hide()},
3E3)},function(){})}})});var config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config);
firebase.auth().onAuthStateChanged(function(a){a?(userID=firebase.auth().currentUser.uid,$("#all-favorites-filters").show(),getFavoriteAlbums(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show(),$("#log_in_message").hide()):($("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide(),
$("#loader").hide(),$("#all-favorites-filters").hide(),$("#all_cards").html(""),$("#log_in_message").show())});var userID;
function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var a=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(a)}).then(function(a){$("#all-favorites-filters").show();userID=user.uid;getFavoriteAlbums();$("#full_menu_login_logout_container").show();$("#login_button").hide();$("#full_menu_login_button").hide();$("#logout_button").show();$("#full_menu_logout_button").show()}).catch(function(a){})}
function logOut(){firebase.auth().signOut().then(function(){location.reload()}).catch(function(a){})}var loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button");loginButton.addEventListener("click",logIn);loginButton2.addEventListener("click",logIn);logoutButton.addEventListener("click",logOut);
logoutButton2.addEventListener("click",logOut);$(".login_button").on("click",logIn);var myFavoriteAlbums;function getFavoriteAlbums(){$.ajax({method:"GET",url:"/api/v1/album/favorites/"+userID,success:function(a){myFavoriteAlbums=a;startFavoritesPage()}})}var filterYear="none",filterGenre="none",filterArtist="none",filterTopTen=!1,albumCardsList,yearsList=[],appleGenreList=[],yearsOnPage=[],artistsList=[];
function masterFilter(a){if("none"!=a)for(var b=0;b<albumCardsList.length;b++){var c=albumCardsList[b];$(c).hasClass(a)||(c.style.display="none")}}function restoreCards(){for(var a=0;a<albumCardsList.length;a++)albumCardsList[a].style.display="inline-flex"}function clearFilters(){filterArtist=filterGenre=filterYear="none";filterTopTen&&toggleStar();restoreCards();whatsOnThePage_genres();whatsOnThePage_years();whatsOnThePage_artists();whatsOnThePage_Top10()}
$(document).on("scroll",function(){$("#year_filter_menu").removeClass("show");$("#genre_filter_menu").removeClass("show");$("#artist_filter_menu").removeClass("show")});function whatsOnThePage_artists(){for(var a=$(".albumCard:visible"),b=[],c=0;c<a.length;c++){var d=$("#"+a[c].id).prop("classList")[3];b.push(d)}a=$(".artist_to_filter_by");for(c=0;c<a.length;c++)d=a[c].id,-1==b.indexOf(d)?$("#"+d).hide():$("#"+d).show()}
function whatsOnThePage_genres(){for(var a=$(".albumCard:visible"),b=[],c=0;c<a.length;c++)for(var d=$("#"+a[c].id).prop("classList"),e=4;e<d.length;e++)b.push(d[e]);a=$(".genre_to_filter_by");for(c=0;c<a.length;c++)d=a[c].id,-1==b.indexOf(d)?$("#"+d).hide():$("#"+d).show()}
function whatsOnThePage_years(){for(var a=$(".albumCard:visible"),b=[],c=0;c<a.length;c++){var d=$("#"+a[c].id).prop("classList")[2];b.push(d)}a=$(".year_to_filter_by");for(c=0;c<a.length;c++)d=a[c].id,-1==b.indexOf(d)?$("#"+d).hide():$("#"+d).show()}function whatsOnThePage_Top10(){for(var a=$(".albumCard:visible"),b=!1,c=0;c<a.length;c++)for(var d=$("#"+a[c].id).prop("classList"),e=4;e<d.length;e++)"Top_10"==d[e]&&(b=!0);b?$("#top_10_button").show():$("#top_10_button").hide()}
function buildYearFilters(){$("#year_filter_menu").html("");$("#year_filter_menu").append('<small id="loading_year_filters" class="text-primary" style="margin-left:8px;">Loading Year Filters...</small>');yearsList=removeDuplicates(yearsList);yearsList.sort().reverse();for(var a=0;a<yearsList.length;a++){var b=yearsList[a];filterYear=="year-"+b?$("#year_filter_menu").append('<a id="year-'+b+'" class="badge badge-primary year_to_filter_by" href="#" onclick="filterByYear('+b+')">'+b+"</a>"):$("#year_filter_menu").append('<a id="year-'+
b+'" class="badge badge-light year_to_filter_by" href="#" onclick="filterByYear('+b+')">'+b+"</a>")}$("#loading_year_filters").hide();whatsOnThePage_years()}function filterByYear(a){filterYear=document.getElementById("year-"+a).classList.contains("badge-primary")?"none":"year-"+a;restoreCards();masterFilter(filterGenre);masterFilter(filterYear);masterFilter(filterArtist);filterByTopTen(filterTopTen);whatsOnThePage_Top10()}var genresList=[];
function getGenreTags(a,b){if(a&&!a.message&&a.tagObjects&&0<a.tagObjects.length)for(var c=0;c<a.tagObjects.length;c++){var d=a.tagObjects[c],e=d.tag;isGenre(e)&&(genresList.push(e),e=replaceSepecialCharacters(e),e=replaceSpaceWithUnderscore(e),$("#card"+b).addClass("genre-"+e));"Top 10"===d.tag&d.creator===userID&&($("#top_10_button").show(),$("#card"+b).addClass("Top_10"))}}var notMyGenres="Music;Adult Alternative;CCM;Christian & Gospel;Christian Rock;College Rock;Hard Rock;Punk;Death Metal/Black Metal;Christian Metal;Hair Metal".split(";");
function buildGenreFilters(){$("#genre_filter_menu").html("");$("#genre_filter_menu").append('<small id="loading_genre_filters" class="text-primary" style="margin-left:8px;">Loading Genre Filters...</small>');appleGenreList=removeDuplicates(appleGenreList.reduce(function(a,b){return a.concat(b)},[]));for(var a=0;a<notMyGenres.length;a++)removeElementFromArray(appleGenreList,notMyGenres[a]);genresList=removeDuplicates(genresList.concat(appleGenreList));genresList.sort();for(a=0;a<genresList.length;a++){var b=
genresList[a];filterGenre=="genre-"+replaceSpaceWithUnderscore(replaceSepecialCharacters(b))?$("#genre_filter_menu").append('<a id="genre-'+replaceSpaceWithUnderscore(replaceSepecialCharacters(b))+'" class="badge badge-primary genre_to_filter_by" href="#" onclick="filterByGenre(\''+b+"')\">"+b+"</a>"):$("#genre_filter_menu").append('<a id="genre-'+replaceSpaceWithUnderscore(replaceSepecialCharacters(b))+'" class="badge badge-light genre_to_filter_by" href="#" onclick="filterByGenre(\''+b+"')\">"+
b+"</a>")}$("#loading_genre_filters").hide();whatsOnThePage_genres()}function filterByGenre(a){filterGenre=document.getElementById("genre-"+replaceSpaceWithUnderscore(replaceSepecialCharacters(a))).classList.contains("badge-primary")?"none":"genre-"+replaceSpaceWithUnderscore(replaceSepecialCharacters(a));restoreCards();masterFilter(filterGenre);masterFilter(filterYear);masterFilter(filterArtist);filterByTopTen(filterTopTen);whatsOnThePage_Top10()}
function startTags(){if(0<myFavoriteAlbums.length)for(var a=0;a<myFavoriteAlbums.length;a++)getGenreTags(myFavoriteAlbums[a],a+1)}
function buildArtistFilters(){$("#artist_filter_menu").html("");$("#artist_filter_menu").append('<small id="loading_artist_filters" class="text-primary" style="margin-left:8px;">Loading Artist Filters...</small>');artistsList=removeDuplicates(artistsList);artistsList.sort();for(var a=0;a<artistsList.length;a++){var b=artistsList[a],c=b;40<b.length&&(b=truncate(b,32));c=replaceSpaceWithUnderscore(removeDoubleSpace(replaceSepecialCharacters(c)));filterArtist=="artist-"+c?$("#artist_filter_menu").append('<a id="artist-'+
c+'" class="badge badge-primary artist_to_filter_by" href="#" onclick="filterByArtist(\''+c+"')\">"+b+"</a>"):$("#artist_filter_menu").append('<a id="artist-'+c+'" class="badge badge-light artist_to_filter_by" href="#" onclick="filterByArtist(\''+c+"')\">"+b+"</a>")}$("#loading_artist_filters").hide();whatsOnThePage_artists()}
function filterByArtist(a){a=replaceSpaceWithUnderscore(removeDoubleSpace(replaceSepecialCharacters(a)));filterArtist=document.getElementById("artist-"+a).classList.contains("badge-primary")?"none":"artist-"+a;restoreCards();masterFilter(filterGenre);masterFilter(filterYear);masterFilter(filterArtist);filterByTopTen(filterTopTen);whatsOnThePage_Top10()}
function toggleStar(){$("#top_star_full").is(":visible")?($("#top_star_full").hide(),$("#top_star_empty").show(),filterTopTen=!1):($("#top_star_full").show(),$("#top_star_empty").hide(),filterTopTen=!0)}function selectTopTen(){toggleStar();restoreCards();masterFilter(filterGenre);masterFilter(filterYear);masterFilter(filterArtist);filterByTopTen(filterTopTen)}
function filterByTopTen(a){if(0!=a)for(a=0;a<albumCardsList.length;a++){var b=albumCardsList[a];$(b).hasClass("Top_10")||(b.style.display="none")}}var addAlbumResults=[];
function populateAddToFavoritesModalResults(a){$("#favorites-search-results").html("");$("#addFavoritesAlbumModal .new-loader").hide();if(a.albums){for(var b=0;b<a.albums.length;b++){var c=a.albums[b],d=b;createFavoritesModalCard(d);populateFavoritesModalCard(c,d)}createFavoritesModalCard(a.albums.length+1);addAlbumResults=a.albums}}
function createFavoritesModalCard(a){$("#favorites-search-results").append('<div id="addFavoritesModalCard'+a+'" class="search-modal-card" data-result-index="'+a+'"><img class="search-modal-card-image" src="" alt=""><div class="search-modal-card-body"><h4 class="search-modal-card-title"></h4><span class="search-modal-card-album"></span></div></div>')}
function populateFavoritesModalCard(a,b){var c=a.artist,d=a.artist,e=a.title,f=a.title;32<c.length&&(c=truncate(c,32));44<e.length&&(e=truncate(e,44));49<d.length&&(d=truncate(d,49));66<f.length&&(f=truncate(f,66));$("#addFavoritesModalCard"+b+" .search-modal-card-title").html('<span class="search-modal-card-large-artist">'+d+'</span><span class="search-modal-card-small-artist">'+c+"</span>");$("#addFavoritesModalCard"+b+" .search-modal-card-album").html('<span class="search-modal-card-large-album">'+
f+'</span><span class="search-modal-card-small-album">'+e+"</span>");$("#addFavoritesModalCard"+b+" .search-modal-card-image").attr("src",a.cover.replace("{w}",260).replace("{h}",260));$("#addFavoritesModalCard"+b).click(function(a){a.preventDefault();a=$(this).data("result-index");var b=addAlbumResults[a];myFavoriteAlbums.find(function(a){return a.appleAlbumID===b.appleAlbumID})?alert('"'+b.title+'" is already in your favorites.'):addToFavorites(b)})}
$("#add-favorites-album-button").click(function(a){a.preventDefault();a=$("#add-favorites-album-input").val().trim().replace(/[^\w\s]/gi,"");$("#favorites-search-results").html("");$("#addFavoritesAlbumModal .new-loader").show();executeSearch(a,"add to favorites")});$("#add-favorites-album-input").keyup(function(a){13===a.keyCode&&$("#add-favorites-album-button").click()});
function addToFavorites(a){$.getJSON("/api/v1/album/albumid/"+a.appleAlbumID,function(b){b.message?"No matching album in the database."===b.message?$.ajax("/api/v1/album/favorites/new",{method:"POST",contentType:"application/json",data:JSON.stringify({user:userID,albumData:a}),success:function(a){a.message?alert(a.message):(myFavoriteAlbums.push(a),$("#addFavoritesAlbumModal").modal("hide"),startFavoritesPage(),$("#add-favorites-album-input").val(""),$("#favorites-search-results").html(""))}}):alert(b.message):
$.ajax("/api/v1/album/favorites/"+b._id,{method:"POST",contentType:"application/json",data:JSON.stringify({user:userID,albumData:a}),success:function(a){a.message?alert(a.message):(myFavoriteAlbums.push(a),$("#addFavoritesAlbumModal").modal("hide"),startFavoritesPage(),$("#add-favorites-album-input").val(""),$("#favorites-search-results").html(""))}})})}
function startFavoritesPage(){$("#all_cards").html("");if(myFavoriteAlbums.message)showDOMelement("log_in_message"),$("#log_in_message").html("<div class='text-secondary' style='text-align:center;'><p style='margin: 20px 5px 50px 5px;'>Looks like you don't have any favorites yet! Click <span class='text-primary' style='cursor:pointer;' data-toggle='modal' data-target='#addFavoritesAlbumModal'>Add Album</span> to find an album and add it to your favorites.</p></div>"),hideDOMelement("filter_by_genre_dropdown_button"),
hideDOMelement("filter_by_year_dropdown_button"),hideDOMelement("filter_by_artist_dropdown_button"),hideDOMelement("clear_filters_button"),hideDOMelement("share-favorites-button"),hideDOMelement("to_top_button");else{$("#log_in_message").html("");$("#artist_filter_menu").html("");$("#artist_filter_menu").append('<small id="loading_artist_filters" class="text-primary" style="margin-left:8px;">Loading Artist Filters...</small>');bubbleSort(myFavoriteAlbums,"releaseDate");myFavoriteAlbums=myFavoriteAlbums.reverse();
for(var a=0;a<myFavoriteAlbums.length;a++){var b=myFavoriteAlbums[a],c=a+1;createCard(b,c);populateCard(b,c)}$(".remove-favorite-button").click(function(a){a.preventDefault();a=$(this).data("album-id");removeFromFavorites(a)});albumCardsList=$(".albumCard");startTags()}}
function removeFromFavorites(a){var b=myFavoriteAlbums.find(function(b){return b._id===a});confirm('Are you sure you want to remove "'+b.title+'" from your favorites? You cannot undo this operation.')&&$.ajax("/api/v1/album/favorites/"+a,{method:"DELETE",contentType:"application/json",data:JSON.stringify({user:userID}),success:function(a){a.message?alert(a.message):(removeElementFromArray(myFavoriteAlbums,b),startFavoritesPage())}})}
$(document).ready(function(){var a=!1;"ontouchstart"in document.documentElement&&(a=!0);a&&(a=document.getElementById("favorites-search-results"),a.style.paddingBottom="0px",a.style.overflowX="scroll")});
