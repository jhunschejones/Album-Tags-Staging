function scrollToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function hideDOMelement(elementId){try{let element;document.getElementById(elementId).style.display="none"}catch(error){}}function showDOMelement(elementId){try{let element;document.getElementById(elementId).style.display="block"}catch(error){}}function replaceUnderscoreWithBackSlash(str){return str.replace(/_/g,"/")}function replaceSpaceWithUnderscore(str){return str.replace(/ /g,"_")}function replaceSepecialCharacters(str){return str.replace(/[^\w\s]/gi,"")}function removeDash(str){return str.replace(/-/g,"")}function removeDoubleSpace(str){return str.replace(/\s\s+/g," ")}function isGenre(str){let myGenres;return-1!=["Metalcore","Pop Punk","Emo","Rock","Post-Hardcore","Accoustic","Screamo","Metal","Nu Metal","Alt Metal","Djent"].indexOf(str)}function removeDuplicates(inputArray){let outputArray=[];for(let i=0;i<inputArray.length;i++)-1==outputArray.indexOf(inputArray[i])&&outputArray.push(inputArray[i]);return outputArray}function removeElementFromArray(array,element){-1!=array.indexOf(element)&&array.splice(array.indexOf(element),1)}function truncate(str,len){var subString=str.substr(0,len-1);return subString.substr(0,subString.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}function truncatePlain(str,len){var subString=str.substr(0,len-1);return subString.substr(0,subString.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")}function bubbleSort(arr,prop){var swapped;do{swapped=!1;for(var i=0;i<arr.length-1;i++)if(parseInt(removeDash(arr[i][prop]))>parseInt(removeDash(arr[i+1][prop]))){var temp=arr[i];arr[i]=arr[i+1],arr[i+1]=temp,swapped=!0}}while(swapped)}function createCard(cardNumber){$("#all_cards").append(`<div id="card${cardNumber}" class="card albumCard"><a class="album_details_link" href=""><img class="card-img-top" src="" alt=""><a/><div class="card-body"><h4 class="card-title"></h4><span class="album"><span class="text-primary">Loading Album Details...</span></span></div></div>`)}function populateCard(album,cardNumber){let smallArtist=album.artist,largeArtist=album.artist,smallAlbum=album.title,largeAlbum=album.title;smallArtist.length>32&&(smallArtist=truncate(smallArtist,32)),smallAlbum.length>44&&(smallAlbum=truncate(smallAlbum,44)),largeArtist.length>49&&(largeArtist=truncate(largeArtist,49)),largeAlbum.length>66&&(largeAlbum=truncate(largeAlbum,66)),$(`#card${cardNumber} .card-body h4`).html(`<span class="large_artist">${largeArtist}</span><span class="small_artist">${smallArtist}</span>`),$(`#card${cardNumber} .card-body .album`).html(`<span class="large_album">${largeAlbum}</span><span class="small_album">${smallAlbum}</span>`),$(`#card${cardNumber}`).addClass(`year-${album.releaseDate.slice(0,4)}`),$(`#card${cardNumber}`).addClass(`artist-${replaceSpaceWithUnderscore(removeDoubleSpace(replaceSepecialCharacters(album.artist)))}`);for(let index=0;index<album.genres.length;index++){let appleGenre=album.genres[index];-1==notMyGenres.indexOf(appleGenre)&&$(`#card${cardNumber}`).addClass(`genre-${replaceSpaceWithUnderscore(replaceSepecialCharacters(appleGenre))}`)}$(`#card${cardNumber} img`).attr("src",album.cover.replace("{w}",260).replace("{h}",260)),$(`#card${cardNumber} .album_details_link`).attr("href",`/albumdetails/${album.appleAlbumID}`),yearsList.push(`${album.releaseDate.slice(0,4)}`),appleGenreList.push(album.genres),artistsList.push(album.artist)}const config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config);let userID;function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var provider=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(provider)}).then(function(result){userID=user.uid,getFavoriteAlbums(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show()}).catch(function(error){})}function logOut(){firebase.auth().signOut().then(function(){$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide()}).catch(function(error){})}firebase.auth().onAuthStateChanged(function(user){user?(userID=firebase.auth().currentUser.uid,getFavoriteAlbums(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show(),$("#log_in_message").hide()):($("#all_cards").html(""),$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide(),$("#loader").hide(),$("#log_in_message").show())});const loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button");let myFavoriteAlbums;function getFavoriteAlbums(){$.ajax({method:"GET",url:"/api/v1/album/favorites/"+userID,success:function(data){myFavoriteAlbums=data,startFavoritesPage()}})}loginButton.addEventListener("click",logIn),loginButton2.addEventListener("click",logIn),logoutButton.addEventListener("click",logOut),logoutButton2.addEventListener("click",logOut),$(".login_button").on("click",logIn);var filterYear="none",filterGenre="none",filterArtist="none",filterTopTen=!1,albumCardsList,yearsList=[],appleGenreList=[],yearsOnPage=[],artistsList=[];function masterFilter(classToFilter){if("none"!=classToFilter)for(let index=0;index<albumCardsList.length;index++){let thisCard=albumCardsList[index];$(thisCard).hasClass(classToFilter)||(thisCard.style.display="none")}}function restoreCards(){for(let index=0;index<albumCardsList.length;index++)albumCardsList[index].style.display="inline"}function clearFilters(){filterYear="none",filterGenre="none",filterArtist="none",1==filterTopTen&&toggleStar(),restoreCards(),whatsOnThePage_genres(),whatsOnThePage_years(),whatsOnThePage_artists(),whatsOnThePage_Top10()}function whatsOnThePage_artists(){let whatsLeft=$(".albumCard:visible"),artistOnPage=[],choppedArtistsOnPage=[];for(let index=0;index<whatsLeft.length;index++){let element=$(`#${whatsLeft[index].id}`).prop("classList")[3];artistOnPage.push(element)}let artistFilters=$(".artist_to_filter_by");for(let index=0;index<artistFilters.length;index++){let element=artistFilters[index].id;-1==artistOnPage.indexOf(element)?$(`#${element}`).hide():$(`#${element}`).show()}}function whatsOnThePage_genres(){let whatsLeft=$(".albumCard:visible"),genreOnPage=[];for(let index=0;index<whatsLeft.length;index++){let element=$(`#${whatsLeft[index].id}`).prop("classList");for(let index=4;index<element.length;index++){let genre=element[index];genreOnPage.push(genre)}}let genreFilters=$(".genre_to_filter_by");for(let index=0;index<genreFilters.length;index++){let element=genreFilters[index].id;-1==genreOnPage.indexOf(element)?$(`#${element}`).hide():$(`#${element}`).show()}}function whatsOnThePage_years(){let whatsLeft=$(".albumCard:visible"),yearsOnPage=[];for(let index=0;index<whatsLeft.length;index++){let element=$(`#${whatsLeft[index].id}`).prop("classList")[2];yearsOnPage.push(element)}let yearFilters=$(".year_to_filter_by");for(let index=0;index<yearFilters.length;index++){let element=yearFilters[index].id;-1==yearsOnPage.indexOf(element)?$(`#${element}`).hide():$(`#${element}`).show()}}function whatsOnThePage_Top10(){let whatsLeft=$(".albumCard:visible"),top10=!1;for(let index=0;index<whatsLeft.length;index++){let element=$(`#${whatsLeft[index].id}`).prop("classList");for(let index=4;index<element.length;index++){let tag;"Top_10"==element[index]&&(top10=!0)}}1==top10?$("#top_10_button").show():$("#top_10_button").hide()}function buildYearFilters(){$("#year_filter_menu").html(""),$("#year_filter_menu").append('<small id="loading_year_filters" class="text-primary" style="margin-left:8px;">Loading Year Filters...</small>'),(yearsList=removeDuplicates(yearsList)).sort().reverse();for(let index=0;index<yearsList.length;index++){let year=yearsList[index];filterYear==`year-${year}`?$("#year_filter_menu").append(`<a id="year-${year}" class="badge badge-primary year_to_filter_by" href="#" onclick="filterByYear(${year})">${year}</a>`):$("#year_filter_menu").append(`<a id="year-${year}" class="badge badge-light year_to_filter_by" href="#" onclick="filterByYear(${year})">${year}</a>`)}$("#loading_year_filters").hide(),whatsOnThePage_years()}function filterByYear(year){filterYear=document.getElementById(`year-${year}`).classList.contains("badge-primary")?"none":`year-${year}`,restoreCards(),masterFilter(filterGenre),masterFilter(filterYear),masterFilter(filterArtist),filterByTopTen(filterTopTen),whatsOnThePage_Top10()}$(document).on("scroll",function(){$("#year_filter_menu").removeClass("show"),$("#genre_filter_menu").removeClass("show")});var genresList=[];function getGenreTags(album,cardNumber){if(album&&!album.message&&album.tagObjects&&album.tagObjects.length>0)for(let index=0;index<album.tagObjects.length;index++){var tagObject=album.tagObjects[index],tag=tagObject.tag;1==isGenre(tag)&&(genresList.push(tag),tag=replaceSpaceWithUnderscore(tag=replaceSepecialCharacters(tag)),$(`#card${cardNumber}`).addClass(`genre-${tag}`)),"Top 10"===tagObject.tag&tagObject.creator===userID&&($("#top_10_button").show(),$(`#card${cardNumber}`).addClass("Top_10"))}}var notMyGenres=["Music","Adult Alternative","CCM","Christian & Gospel","Christian Rock","College Rock","Hard Rock","Punk","Death Metal/Black Metal","Christian Metal","Hair Metal"];function buildGenreFilters(){$("#genre_filter_menu").html(""),$("#genre_filter_menu").append('<small id="loading_genre_filters" class="text-primary" style="margin-left:8px;">Loading Genre Filters...</small>'),appleGenreList=removeDuplicates(appleGenreList.reduce((a,b)=>a.concat(b),[]));for(let index=0;index<notMyGenres.length;index++){let genre=notMyGenres[index];removeElementFromArray(appleGenreList,genre)}(genresList=removeDuplicates(genresList.concat(appleGenreList))).sort();for(let index=0;index<genresList.length;index++){let genre=genresList[index];filterGenre==`genre-${replaceSpaceWithUnderscore(replaceSepecialCharacters(genre))}`?$("#genre_filter_menu").append(`<a id="genre-${replaceSpaceWithUnderscore(replaceSepecialCharacters(genre))}" class="badge badge-primary genre_to_filter_by" href="#" onclick="filterByGenre('${genre}')">${genre}</a>`):$("#genre_filter_menu").append(`<a id="genre-${replaceSpaceWithUnderscore(replaceSepecialCharacters(genre))}" class="badge badge-light genre_to_filter_by" href="#" onclick="filterByGenre('${genre}')">${genre}</a>`)}$("#loading_genre_filters").hide(),whatsOnThePage_genres()}function filterByGenre(genre){filterGenre=document.getElementById(`genre-${replaceSpaceWithUnderscore(replaceSepecialCharacters(genre))}`).classList.contains("badge-primary")?"none":`genre-${replaceSpaceWithUnderscore(replaceSepecialCharacters(genre))}`,restoreCards(),masterFilter(filterGenre),masterFilter(filterYear),masterFilter(filterArtist),filterByTopTen(filterTopTen),whatsOnThePage_Top10()}function startTags(){if(myFavoriteAlbums.length>0)for(let index=0;index<myFavoriteAlbums.length;index++){let album,card;getGenreTags(myFavoriteAlbums[index],index+1)}}function buildArtistFilters(){$("#artist_filter_menu").html(""),$("#artist_filter_menu").append('<small id="loading_artist_filters" class="text-primary" style="margin-left:8px;">Loading Artist Filters...</small>'),(artistsList=removeDuplicates(artistsList)).sort();for(let index=0;index<artistsList.length;index++){let artist=artistsList[index],longArtist=artist;artist.length>40&&(artist=truncate(artist,32));let cleanArtist=replaceSpaceWithUnderscore(removeDoubleSpace(replaceSepecialCharacters(longArtist)));filterArtist==`artist-${cleanArtist}`?$("#artist_filter_menu").append(`<a id="artist-${cleanArtist}" class="badge badge-primary artist_to_filter_by" href="#" onclick="filterByArtist('${cleanArtist}')">${artist}</a>`):$("#artist_filter_menu").append(`<a id="artist-${cleanArtist}" class="badge badge-light artist_to_filter_by" href="#" onclick="filterByArtist('${cleanArtist}')">${artist}</a>`)}$("#loading_artist_filters").hide(),whatsOnThePage_artists()}function filterByArtist(artist){let cleanArtist=replaceSpaceWithUnderscore(removeDoubleSpace(replaceSepecialCharacters(artist)));filterArtist=document.getElementById(`artist-${cleanArtist}`).classList.contains("badge-primary")?"none":`artist-${cleanArtist}`,restoreCards(),masterFilter(filterGenre),masterFilter(filterYear),masterFilter(filterArtist),filterByTopTen(filterTopTen),whatsOnThePage_Top10()}function toggleStar(){$("#top_star_full").is(":visible")?($("#top_star_full").hide(),$("#top_star_empty").show(),filterTopTen=!1):($("#top_star_full").show(),$("#top_star_empty").hide(),filterTopTen=!0)}function selectTopTen(){toggleStar(),restoreCards(),masterFilter(filterGenre),masterFilter(filterYear),masterFilter(filterArtist),filterByTopTen(filterTopTen)}function filterByTopTen(classToFilter){if(0!=classToFilter)for(let index=0;index<albumCardsList.length;index++){let thisCard=albumCardsList[index];$(thisCard).hasClass("Top_10")||(thisCard.style.display="none")}}function startFavoritesPage(){if($("#all_cards").html(""),myFavoriteAlbums.message)return showDOMelement("log_in_message"),$("#log_in_message").html("<div style='text-align:center;margin: 20px 0px 50px 0px;'><p>Looks like you don't have any favorites yet!</p><p><a href='/search'>Search</a> for albums then click the <img src='../images/heart-unliked.png' height='30' width='auto'> icon on the Update</p><p>page to add them to your favorites.</p></div>"),hideDOMelement("filter_by_genre_dropdown_button"),hideDOMelement("filter_by_year_dropdown_button"),hideDOMelement("filter_by_artist_dropdown_button"),hideDOMelement("clear_filters_button"),void hideDOMelement("to_top_button");$("#log_in_message").html(""),$("#artist_filter_menu").html(""),$("#artist_filter_menu").append('<small id="loading_artist_filters" class="text-primary" style="margin-left:8px;">Loading Artist Filters...</small>'),bubbleSort(myFavoriteAlbums,"releaseDate"),myFavoriteAlbums=myFavoriteAlbums.reverse();for(let index=0;index<myFavoriteAlbums.length;index++){let album=myFavoriteAlbums[index],card=index+1;createCard(card),populateCard(album,card)}albumCardsList=$(".albumCard"),startTags()}