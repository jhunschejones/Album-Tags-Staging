function scrollToTop(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function toTitleCase(str){return str.replace(/\b\w+/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})}function removeExtraSpace(str){return str.replace(/\s\s+/g," ")}function replaceBackSlashWithHtml(str){return str.replace(/\//g,"&sol;")}const months=["January","February","March","April","May","June","July","August","September","October","November","December"];function makeNiceDate(uglyDate){let year=uglyDate.slice(0,4),day=uglyDate.slice(8,10),uglyMonth=uglyDate.slice(5,7),niceMonth;return`${months[uglyMonth-1]} ${day}, ${year}`}function safeParse(content){return content=content.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/\//g,"&#47;").replace(/\\/g,"&#92;").replace(/\(/g,"&#40;").replace(/\)/,"&#41;").replace(/\./g,"&#46;").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/\{/g,"&#123;").replace(/\}/g,"&#125;").replace(/\=/g,"&#61;")}function hideDOMelement(elementId){try{let element;document.getElementById(elementId).style.display="none"}catch(error){}}function showDOMelement(elementId){try{let element;document.getElementById(elementId).style.display="block"}catch(error){}}var isEqual=function(value,other){var type=Object.prototype.toString.call(value);if(type!==Object.prototype.toString.call(other))return!1;if(["[object Array]","[object Object]"].indexOf(type)<0)return!1;var valueLen="[object Array]"===type?value.length:Object.keys(value).length,otherLen;if(valueLen!==("[object Array]"===type?other.length:Object.keys(other).length))return!1;var compare=function(item1,item2){var itemType=Object.prototype.toString.call(item1);if(["[object Array]","[object Object]"].indexOf(itemType)>=0){if(!isEqual(item1,item2))return!1}else{if(itemType!==Object.prototype.toString.call(item2))return!1;if("[object Function]"===itemType){if(item1.toString()!==item2.toString())return!1}else if(item1!==item2)return!1}};if("[object Array]"===type){for(var i=0;i<valueLen;i++)if(!1===compare(value[i],other[i]))return!1}else for(var key in value)if(value.hasOwnProperty(key)&&!1===compare(value[key],other[key]))return!1;return!0};function scrollDown(){let isTouchDevice;"ontouchstart"in document.documentElement&&(isTouchDevice=!0),1==isTouchDevice&screen.width<570&&window.scrollTo(0,document.body.scrollHeight)}const albumId=window.location.pathname.replace("/update/","");var albumResult=!1,currentTags=[],currentAuthors=[];function getAlbumDetails(){$.getJSON("/api/v1/album/albumid/"+albumId,function(album){if(!album.message)return albumResult=album,populateAlbumInfo(album),populateTags(album),void findDirectConnections();$.getJSON("/api/v1/apple/details/"+albumId,function(album){albumResult=album,populateAlbumInfo(album),populateTags(album),findDirectConnections()})})}function populateAlbumInfo(inputAlbum){var artist=inputAlbum.artist,album=inputAlbum.title,label=inputAlbum.recordCompany,cover=inputAlbum.cover.replace("{w}",370).replace("{h}",370),applemusicurl=inputAlbum.appleURL,release=makeNiceDate(inputAlbum.releaseDate);$(".albumdetails_artist").append(`<span onclick="moreByThisArtist('${artist}')" data-toggle="tooltip" data-placement="right" title="Search This Artist" data-trigger="hover" style="cursor:pointer;">${artist}</span>`),$(".albumdetails_album").append(`<span id="the_album_name" data-toggle="tooltip" data-placement="right" title="Click to Show Album ID" data-trigger="hover" onclick="showAlbumID()" style="cursor:pointer;">${album}</span><span id="the_album_id" class="text-secondary" data-toggle="tooltip" data-placement="right" title="Select & Copy Album ID" data-trigger="hover" style="display:none;">${albumId}</span>`),$(".albumdetails_artist").append('<img src="../images/heart-unliked.png" height="30" id="add_to_favorites" style="cursor:pointer;margin-left:10px;" data-toggle="tooltip" title="Add To Favorites" data-trigger="hover">'),$(".albumdetails_artist").append('<img src="../images/heart-liked.png" height="30" id="remove_from_favorites" style="cursor:pointer;margin-left:10px;" data-toggle="tooltip" title="Remove From Favorites" data-trigger="hover">'),$(".albumdetails_cover").attr("src",cover,"<br"),$(".applemusicurl").attr("href",applemusicurl,"<br>"),$(".albumdetails_label").append(label,"<br>"),$(".albumdetails_release").append(release,"<br>"),albumResult.favoritedBy&&-1!=albumResult.favoritedBy.indexOf(userID)?($("#remove_from_favorites").show(),$("#add_to_favorites").hide()):($("#remove_from_favorites").hide(),$("#add_to_favorites").show()),document.getElementById("add_to_favorites").addEventListener("click",addToFavorites),document.getElementById("remove_from_favorites").addEventListener("click",removeFromFavorites)}function populateTags(album){if($(".tag_results").text(""),currentTags=[],currentAuthors=[],album.tagObjects)for(let index=0;index<album.tagObjects.length;index++){const tag=album.tagObjects[index].tag,author=album.tagObjects[index].creator;currentTags.push(tag),currentAuthors.push(author),author===userID&&$(".tag_results").append(`<tr class="album_details_tags update_tags author-${author}"><td>${safeParse(tag)}</td><td><a href="#" class="deletetaglink" rel="${index}">Delete</a></td></tr>`)}}function addTag(){let newTag=$("#new_tag").val().trim();if(newTag){if(newTag.includes("<")&&newTag.includes(">")||newTag.includes(".")||newTag.includes("{")||newTag.includes("}"))return alert("Some characters are not allowed in tags, sorry!"),void $("#new_tag").val("");newTag=removeExtraSpace(replaceBackSlashWithHtml(toTitleCase(newTag))).trim();const newAuthor=userID;var isThisADuplicate=currentTags.indexOf(newTag);if(-1!==isThisADuplicate&&currentAuthors[isThisADuplicate]==newAuthor)return alert(`You already added the '${newTag}' tag to this album!`),void $("#new_tag").val("");currentTags.push(newTag),currentAuthors.push(newAuthor),$(".warning_label").text(""),$.ajax(`/api/v1/album/tags/${albumResult._id||"new"}`,{method:"POST",contentType:"application/json",data:JSON.stringify({album:albumResult,creator:userID,tag:newTag}),success:function(album){albumResult=album,populateTags(album)}})}else alert("Please enter a non-empty tag.");$("#new_tag").val("")}function showAlbumID(){$("#the_album_id").tooltip("disable"),showDOMelement("the_album_id"),hideDOMelement("the_album_name"),setTimeout(showAlbumName,7e3)}function showAlbumName(){$("#the_album_name").tooltip("disable"),showDOMelement("the_album_name"),hideDOMelement("the_album_id")}function deleteTag(event){var confirmation;if(event.preventDefault(),!0===confirm("Are you sure you want to delete a tag?")){const index=$(this).attr("rel"),deleteTag=currentTags[index],deleteCreator=currentAuthors[index];currentTags.splice(index,1),currentAuthors.splice(index,1),$.ajax(`/api/v1/album/tags/${albumResult._id}`,{method:"DELETE",contentType:"application/json",data:JSON.stringify({tag:deleteTag,creator:deleteCreator}),success:function(album){albumResult=album,populateTags(album)}})}}function moreByThisArtist(artist){sessionStorage.setItem("artist",artist),window.location.href="/search"}function findDirectConnections(){let directConnections=[];if(albumResult.connectionObjects)for(let index=0;index<albumResult.connectionObjects.length;index++){var connectionObject=albumResult.connectionObjects[index];connectionObject&&connectionObject.creator===userID&&directConnections.push(connectionObject)}populateConnections(directConnections)}function populateConnections(directConnections){if($(".connection_results").text(""),directConnections.length>0){showDOMelement("connections_card");for(let index=0;index<directConnections.length;index++){let connection=directConnections[index];if(connection!=albumId){const cover=connection.cover.replace("{w}",75).replace("{h}",75);$(".connection_results").append(`<div class="connection"><a href="/albumdetails/${connection.appleAlbumID}" data-toggle="tooltip" data-placement="right" title="Album Details" data-trigger="hover"><img class="small_cover" src="${cover}"></a><div><span class="connection-delete-button" data-connection-id="${connection.databaseID}" data-toggle="tooltip" data-placement="right" title="Delete Connection" data-trigger="hover">&#10005;</span></div></div>`)}}}let isTouchDevice;$(".connection-delete-button").on("click",function(){deleteConnection($(this).attr("data-connection-id"))}),"ontouchstart"in document.documentElement&&(isTouchDevice=!0),0==isTouchDevice&&$('[data-toggle="tooltip"]').tooltip()}function validateNewConnection(){const newAlbumID=parseInt($("#new_connection").val().trim());if(newAlbumID&&newAlbumID.toString().length>0){if(newAlbumID.toString()===albumResult.appleAlbumID.toString())return alert("You cannot connect an album to itself."),void $("#new_connection").val("");if(albumResult.connectionObjects){let myConnectionsOnPage=[];if(albumResult.connectionObjects.forEach(connectionObject=>{connectionObject.creator===userID&&myConnectionsOnPage.push(connectionObject.appleAlbumID)}),-1!==myConnectionsOnPage.indexOf(newAlbumID.toString()))return alert("You cannot add a duplicate connection."),void $("#new_connection").val("");addConnection(newAlbumID)}else addConnection(newAlbumID)}else alert("Please enter an Apple album Id value to make a connection."),$("#new_connection").val("")}function addConnection(newAlbumID){$.getJSON("/api/v1/apple/details/"+newAlbumID,function(appleAlbum){appleAlbum.message?alert("Sorry, Apple says that's not an album ID."):$.getJSON("/api/v1/album/albumid/"+newAlbumID,function(databaseAlbum){databaseAlbum.message?$.ajax(`/api/v1/album/connections/${albumResult._id||"new"}`,{method:"POST",contentType:"application/json",data:JSON.stringify({albumOne:albumResult,albumTwo:appleAlbum,creator:userID}),success:function(album){albumResult=album,findDirectConnections()}}):$.ajax(`/api/v1/album/connections/${albumResult._id||"new"}`,{method:"POST",contentType:"application/json",data:JSON.stringify({albumOne:albumResult,albumTwo:databaseAlbum,creator:userID}),success:function(album){albumResult=album,findDirectConnections()}})}),$("#new_connection").val("")})}function deleteConnection(connectedAlbum){const confirmation=confirm("Are you sure you want to delete a connection?");!0===confirmation&&$.ajax(`/api/v1/album/connections/${albumResult._id}`,{method:"DELETE",contentType:"application/json",data:JSON.stringify({albumTwo:connectedAlbum.toString(),albumOne:albumResult._id.toString(),creator:userID}),success:function(album){albumResult=album,findDirectConnections()}})}function addToFavorites(){$.ajax(`/api/v1/album/favorites/${albumResult._id||"new"}`,{method:"POST",contentType:"application/json",data:JSON.stringify({user:userID,albumData:albumResult}),success:function(album){(albumResult=album).favoritedBy&&-1!=albumResult.favoritedBy.indexOf(userID)?($("#remove_from_favorites").show(),$("#add_to_favorites").hide()):($("#remove_from_favorites").hide(),$("#add_to_favorites").show())}})}function removeFromFavorites(){$.ajax(`/api/v1/album/favorites/${albumResult._id}`,{method:"DELETE",contentType:"application/json",data:JSON.stringify({user:userID}),success:function(album){(albumResult=album).favoritedBy&&-1!=albumResult.favoritedBy.indexOf(userID)?($("#remove_from_favorites").show(),$("#add_to_favorites").hide()):($("#remove_from_favorites").hide(),$("#add_to_favorites").show())}})}const config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config);let userID;function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var provider=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(provider)}).then(function(result){userID=user.uid,getAlbumDetails(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show()}).catch(function(error){})}function logOut(){firebase.auth().signOut().then(function(){$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide()}).catch(function(error){})}firebase.auth().onAuthStateChanged(function(user){user?(userID=firebase.auth().currentUser.uid,getAlbumDetails(),$("#login-message").hide(),$("#all_the_things").show(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show(),$("#log_in_message").hide()):($("#all_the_things").hide(),$("#login-message").show(),$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide())});const loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button");loginButton.addEventListener("click",logIn),loginButton2.addEventListener("click",logIn),logoutButton.addEventListener("click",logOut),logoutButton2.addEventListener("click",logOut),$("#tags_table tbody").on("click","td a.deletetaglink",deleteTag);var isTouchDevice=!1;$(function(){setTimeout(function(){"ontouchstart"in document.documentElement&&(isTouchDevice=!0),0==isTouchDevice&&$('[data-toggle="tooltip"]').tooltip()},1e3)}),document.getElementById("add_tag_button").addEventListener("click",function(event){event.preventDefault(),addTag()}),document.getElementById("add_connection_button").addEventListener("click",function(event){event.preventDefault(),validateNewConnection()}),$(".login_button").on("click",logIn),$("input[type=search]").on("keydown",function(e){13==e.which&&(e.preventDefault(),$("#new_connection").is(":focus")&&validateNewConnection(),$("#new_tag").is(":focus")&&addTag())}),Mousetrap.bind("ctrl+t",function(e){return $("#new_tag").focus(),!1}),Mousetrap.bind("ctrl+c",function(e){return $("#new_connection").focus(),!1});