var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");function truncate(a,b){a=a.substr(0,b-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}
function removeDash(a){return a.replace(/-/g,"")}function bubbleSort(a,b){do{var c=!1;for(var d=0;d<a.length-1;d++)parseInt(removeDash(a[d][b]))>parseInt(removeDash(a[d+1][b]))&&(c=a[d],a[d]=a[d+1],a[d+1]=c,c=!0)}while(c)}function scrollToTop(){document.body.scrollTop=0;document.documentElement.scrollTop=0}function textToClassName(a){return a.replace(/[^\w\s]/gi,"").replace(/\s\s+/g," ").replace(/ /g,"_").toLowerCase()}
function isGenre(a){return-1!=="Metalcore;Pop Punk;Emo;Rock;Post-Hardcore;Accoustic;Screamo;Metal;Nu Metal;Alt Metal;Djent;Accoustic;Jazz;Ska;Rap-Rock;Progressive;Punk;Rap".split(";").indexOf(a)}function removeFromArray(a,b){-1!==a.indexOf(b)&&a.splice(a.indexOf(b),1)}function addToArray(a,b){-1===a.indexOf(b)&&a.push(b)}function removeDuplicates(a){for(var b=[],c=0;c<a.length;c++)-1==b.indexOf(a[c])&&b.push(a[c]);return b}
var listData,listType=(new URL(document.location)).searchParams.get("type"),listID=(new URL(document.location)).searchParams.get("id");function getList(){"favorites"===listType?$.ajax({method:"GET",url:"/api/v1/list/favorites/"+listID,success:function(a){listData=a;$("#main-page-loader").hide();populateList()}}):$.ajax({method:"GET",url:"/api/v1/list/"+listID,success:function(a){listData=a;$("#main-page-loader").hide();populateList()}})}
function createCard(a){$("#albums").append('<div id="card'+a+'" class="card list-card"><a class="album-details-link" href=""><img class="card-img-top" src=""><a/><div class="card-body"><h4 class="card-title"></h4><span class="album-title"></span></div></div>')}
function populateCard(a,b){var c=32<a.artist.length?truncate(a.artist,32):a.artist,d=49<a.artist.length?truncate(a.artist,49):a.artist,e=44<a.title.length?truncate(a.title,44):a.title,f=66<a.title.length?truncate(a.title,66):a.title;$("#card"+b+" .card-body h4").html('<span class="large_artist">'+d+'</span><span class="small_artist">'+c+"</span>");$("#card"+b+" .card-body .album-title").html('<span class="large_album">'+f+'</span><span class="small_album">'+e+"</span>");$("#card"+b+" .card-img-top").attr("src",
a.cover.replace("{w}",260).replace("{h}",260));$("#card"+b+" .album-details-link").attr("href","/album/"+a.appleAlbumID);$("#card"+b).append('<span class="album-delete-button" data-album-id="'+a.appleAlbumID+'" data-toggle="tooltip" data-placement="right" title="Remove from list" data-trigger="hover">&#10005;</span></li>');listData.user===userID&&"favorites"!==listType?$(".album-delete-button").show():$(".album-delete-button").hide()}
function populateList(){$("#page-info-button").hide();$("#no-albums-message").hide();$("#albums").html("");var a=listData.displayName;a&&""!==a.trim||(a="Unknown");$("#list-title").text(""+listData.title);$("#list-title").after('<h5 id="page-info-button" class="text-secondary" data-toggle="modal" data-target="#pageInfoModal">&#9432;</h5>');"userlist"!==listType&&$("#page-info-button").hide();$("#list-creator").text("by: "+a);if(listData.albums&&0<listData.albums.length){a=filterAlbums();0<a.length?
$("#no-albums-message").hide():(clearFilters(),a=filterAlbums(),0<a.length?($("#no-albums-message").hide(),$("#albums").html("")):$("#no-albums-message").show());var b=0;a.forEach(function(a){b+=1;createCard(b);populateCard(a,b)});$(".album-delete-button").on("click",function(){listData.user!==userID?alert("Sorry! Only the list creator can delete albums."):"userlist"===listType?removeAlbum($(this).attr("data-album-id")):alert("Sorry! This type of list won't let you delete albums.")});populateFilters(a)}else $("#no-albums-message").show(),
populateFilters([]);displayButtons()}
function removeAlbum(a){if(listData.user!==userID)alert("Sorry, only the list creator can delete albums from a list.");else{var b=listData.albums.find(function(b){return b.appleAlbumID===a});confirm('Are you sure you want to remove "'+b.title+'" from this list? You cannot undo this operation.')&&$.ajax({method:"PUT",url:"/api/v1/list/"+listID,contentType:"application/json",data:JSON.stringify({method:"remove album",appleAlbumID:b.appleAlbumID,title:b.title,artist:b.artist,releaseDate:b.releaseDate,
cover:b.cover,genres:b.genres}),success:function(a){listData=a;populateList()}})}}
function editDisplayName(){var a=$("#list-display-name-input").val().trim();a===listData.displayName?alert('The display name for this list is already set as "'+listData.displayName+'"'):30<a.length?alert("Display names must be shorter than 30 characters in length."):$.ajax({method:"PUT",url:"/api/v1/list/"+listID,contentType:"application/json",data:JSON.stringify({method:"change display name",displayName:a}),success:function(a){a.message?alert(a.message):(listData=a,populateList(),$("#list-update-success").text("List info updated!"),
setTimeout(function(){$("#list-update-success").html("&nbsp;")},3E3))}})}
function editListTitle(){var a=$("#list-title-input").val().trim();a===listData.title?alert('The title for this list is already "'+listData.title+'"'):60<a.length?alert("List titles must be shorter than 60 characters in length."):a&&0<a.length?$.ajax({method:"PUT",url:"/api/v1/list/"+listID,contentType:"application/json",data:JSON.stringify({method:"change title",title:a}),success:function(a){a.message?alert(a.message):(listData=a,populateList(),$("#list-update-success").text("List info updated!"),
setTimeout(function(){$("#list-update-success").html("&nbsp;")},3E3))}}):(alert("A non-blank title is required for every list."),$("#list-title-input").val(listData.title))}var addAlbumResults=[];
function populateAddToListModalResults(a){$("#add-album-search-results").html("");$("#add-album-card-body .new-loader").hide();if(a.albums&&0<a.albums.length){for(var b=0;b<a.albums.length;b++){var c=a.albums[b],d=b;createAddAlbumModalCard(d);populateAddAlbumModalCard(c,d)}$("#add-album-search-results").append('<div id="add-search-modal-placeholder">&nbsp;</div>');addAlbumResults=a.albums}else $("#add-album-search-results").after('<div id="no-results-message" class="text-primary" style="text-align:center;">It looks like no albums matched your search terms. Try a different search!</div>')}
function createAddAlbumModalCard(a){$("#add-album-search-results").append('<div id="addAlbumModalCard'+a+'" class="search-modal-card" data-result-index="'+a+'"><img class="search-modal-card-image" src="" alt=""><div class="search-modal-card-body"><h4 class="search-modal-card-title"></h4><span class="search-modal-card-album"></span></div></div>')}
function populateAddAlbumModalCard(a,b){var c=32<a.artist.length?truncate(a.artist,32):a.artist,d=49<a.artist.length?truncate(a.artist,49):a.artist,e=44<a.title.length?truncate(a.title,44):a.title,f=66<a.title.length?truncate(a.title,66):a.title;$("#addAlbumModalCard"+b+" .search-modal-card-title").html('<span class="search-modal-card-large-artist">'+d+'</span><span class="search-modal-card-small-artist">'+c+"</span>");$("#addAlbumModalCard"+b+" .search-modal-card-album").html('<span class="search-modal-card-large-album">'+
f+'</span><span class="search-modal-card-small-album">'+e+"</span>");$("#addAlbumModalCard"+b+" .search-modal-card-image").attr("src",a.cover.replace("{w}",260).replace("{h}",260));$("#addAlbumModalCard"+b).click(function(a){a.preventDefault();a=$(this).data("result-index");addToList(addAlbumResults[a])})}
function addToList(a){a&&(listData.albums.find(function(b){return b.appleAlbumID===a.appleAlbumID})?alert('"'+a.title+'" is already in this list.'):$.ajax({method:"PUT",url:"/api/v1/list/"+listData._id,contentType:"application/json",data:JSON.stringify({method:"add album",appleAlbumID:a.appleAlbumID,title:a.title,artist:a.artist,releaseDate:a.releaseDate,cover:a.cover,genres:a.genres}),success:function(a){a.message?alert(a.message):(listData=a,populateList(),$("#editListModal").modal("hide"))}}))}
function toggleActiveInfoTab(a){$("#editListModal .active").removeClass("active").addClass("inactive-list-edit-tab");$(a).removeClass("inactive-list-edit-tab").addClass("active");$(".edit-list-card-body").hide();a=a.data("card");$("#"+a+"-card-body").show()}
function getCleanAlbumArray(a){var b=[];a.forEach(function(a){a.album?b.push(a.album):b.push(a)});b.forEach(function(a){a.tagObjects&&(a.tagGenres=[],a.tagObjects.forEach(function(b){b.creator===listData.user&&isGenre(b.tag)&&-1===a.tagGenres.indexOf(b.tag)&&a.tagGenres.push(b.tag)}));a.year=a.releaseDate.slice(0,4)});return b}
function getFilterObject(){return{year:(new URL(document.location)).searchParams.get("year"),artist:(new URL(document.location)).searchParams.get("artist"),genre:(new URL(document.location)).searchParams.get("genre")}}
function filterAlbums(){var a=getFilterObject(),b=getCleanAlbumArray(listData.albums);a.genre&&(b=b.filter(function(b){return b.tagGenres?-1!==b.tagGenres.indexOf(a.genre):!1}));a.artist&&(b=b.filter(function(b){return!!b.artist&&b.artist===a.artist}));a.year&&(b=b.filter(function(b){return!!b.year&&b.year===a.year}));bubbleSort(b,"releaseDate");return b=b.reverse()}
function populateFilters(a){var b=getFilterObject();$("#year-filter-dropdown").html("");$("#artist-filter-dropdown").html("");$("#genre-filter-dropdown").html("");if(1>a.length)$(".remove-if-no-albums").hide();else{$(".remove-if-no-albums").show();var c=[];a.forEach(function(a){addToArray(c,a.releaseDate.slice(0,4))});c.sort().reverse();c.forEach(function(a){b.year&&a===b.year?$("#year-filter-dropdown").append('<span class="badge badge-primary year-filter" data-year="'+a+'">'+a+"</span>"):$("#year-filter-dropdown").append('<span class="badge badge-light year-filter" data-year="'+
a+'">'+a+"</span>")});$(".year-filter").click(function(a){a.preventDefault();toggleFilter("year",$(this).data("year"))});var d=[];a.forEach(function(a){addToArray(d,a.artist)});d.sort();d.forEach(function(a){b.artist&&a===b.artist?$("#artist-filter-dropdown").append('<span class="badge badge-primary artist-filter" data-artist="'+a+'">'+(32<a.length?truncate(a,32):a)+"</span>"):$("#artist-filter-dropdown").append('<span class="badge badge-light artist-filter" data-artist="'+a+'">'+(32<a.length?truncate(a,
32):a)+"</span>")});$(".artist-filter").click(function(a){a.preventDefault();toggleFilter("artist",$(this).data("artist"))});var e=[];a.forEach(function(a){a.tagGenres&&a.tagGenres.forEach(function(a){isGenre(a)?addToArray(e,a):console.log("Ignored genre: '"+a+"'")})});1>e.length?$("#filter-by-genre-button").hide():$("#filter-by-genre-button").show();e.sort();e.forEach(function(a){b.genre&&a===b.genre?$("#genre-filter-dropdown").append('<span class="badge badge-primary genre-filter" data-genre="'+
a+'">'+a+"</span>"):b.genre||$("#genre-filter-dropdown").append('<span class="badge badge-light genre-filter" data-genre="'+a+'">'+a+"</span>")});$(".genre-filter").click(function(a){a.preventDefault();toggleFilter("genre",$(this).data("genre"))})}}function toggleFilter(a,b){var c=new URL(document.location);c.searchParams.get(a)==b?c.searchParams.delete(a):c.searchParams.set(a,b);history.replaceState({},"",c);populateList()}
function clearFilters(){var a=new URL(document.location);a.searchParams.delete("year");a.searchParams.delete("artist");a.searchParams.delete("genre");history.replaceState({},"",a);populateList()}$("#clear-filters-button").click(clearFilters);
$("#add-album-modal-button").click(function(a){a.preventDefault();a=$("#add-album-modal-input").val().trim().replace(/[^\w\s]/gi,"");$("#add-album-search-results").html("");$("#no-results-message").remove();$("#add-album-card-body .new-loader").show();executeSearch(a,"add to list")});$("#add-album-modal-input").keyup(function(a){13===a.keyCode&&$("#add-album-modal-button").click()});
$("#edit-button").click(function(a){a.preventDefault();listData.user!==userID?alert("Sorry! Only the list creator can edit the information for this list."):(toggleActiveInfoTab($("#edit-list-modal-nav-tab")),$("#editListModal").modal("show"),$("#list-title-input").val(listData.title),$("#list-display-name-input").val(listData.displayName||"Unknown"))});
$("#add-album-button").click(function(a){a.preventDefault();listData.user!==userID?alert("Sorry! Only the list creator can add albums to this list."):(toggleActiveInfoTab($("#add-album-modal-nav-tab")),$("#editListModal").modal("show"),$("#list-title-input").val(listData.title),$("#list-display-name-input").val(listData.displayName||"Unknown"))});$(".add-album-refrence").click(function(a){a.preventDefault();$("#pageInfoModal").modal("hide");$("#add-album-button").click()});
$(".edit-list-refrence").click(function(a){a.preventDefault();$("#pageInfoModal").modal("hide");$("#edit-button").click()});$("#list-title-input").keyup(function(a){13===a.keyCode&&$("#update-list-title").click()});$("#list-display-name-input").keyup(function(a){13===a.keyCode&&$("#update-list-display-name").click()});document.getElementById("update-list-display-name").addEventListener("click",editDisplayName);document.getElementById("update-list-title").addEventListener("click",editListTitle);
$("#editListModal .nav-link").click(function(a){a.preventDefault();toggleActiveInfoTab($(this))});$("#to-top-button").click(scrollToTop);$(document).on("scroll",function(){$("#year-filter-dropdown").removeClass("show");$("#genre-filter-dropdown").removeClass("show");$("#artist-filter-dropdown").removeClass("show")});
var config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config),userID=!1;
firebase.auth().onAuthStateChanged(function(a){a?(userID=firebase.auth().currentUser.uid,getList(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show()):(userID=!1,getList(),$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide(),$("#main-page-loader").hide())});
function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var a=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(a)}).then(function(a){userID=user.uid;populateList();$("#full_menu_login_logout_container").show();$("#login_button").hide();$("#full_menu_login_button").hide();$("#logout_button").show();$("#full_menu_logout_button").show()}).catch(function(a){})}
function logOut(){firebase.auth().signOut().then(function(){userID=!1;$("#full_menu_login_logout_container").show();$("#login_button").show();$("#full_menu_login_button").show();$("#logout_button").hide();$("#full_menu_logout_button").hide();displayButtons()}).catch(function(a){})}
function displayButtons(){listData.user===userID&&"userlist"===listType?($("#edit-button").show(),$("#add-album-button").show(),$("#page-info-button").show()):($("#page-info-button").hide(),$("#edit-button").hide(),$("#add-album-button").hide(),$(".album-delete-button").hide())}var loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button");
loginButton.addEventListener("click",logIn);loginButton2.addEventListener("click",logIn);logoutButton.addEventListener("click",logOut);logoutButton2.addEventListener("click",logOut);$(".login_button").on("click",logIn);$(document).ready(function(){var a=!1;"ontouchstart"in document.documentElement&&(a=!0);a&&(a=document.getElementById("add-album-search-results"),a.style.paddingBottom="0px",a.style.overflowX="scroll")});
