function truncate(str,len){var subString=str.substr(0,len-1);return subString.substr(0,subString.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}let listData;const listID=window.location.pathname.replace("/list/","");let isFavoritesList=!1;function getList(){listID.length<25?$.ajax({method:"GET",url:"/api/v1/list/"+listID,success:function(data){listData=data,$("#loader").hide(),populateList()}}):(isFavoritesList=!0,$.ajax({method:"GET",url:"/api/v1/list/favorites/"+listID,success:function(data){listData=data,$("#loader").hide(),populateList()}}))}function createCard(cardNumber){$("#albums").append(`<div id="card${cardNumber}" class="card albumCard"><a class="album_details_link" href=""><img class="card-img-top" src="" alt=""><a/><div class="card-body"><h4 class="card-title"></h4><span class="album"><span class="text-primary">Loading Album Details...</span></span></div></div>`)}function populateCard(album,cardNumber){let smallArtist=album.artist,largeArtist=album.artist,smallAlbum=album.title,largeAlbum=album.title;smallArtist.length>32&&(smallArtist=truncate(smallArtist,32)),smallAlbum.length>44&&(smallAlbum=truncate(smallAlbum,44)),largeArtist.length>49&&(largeArtist=truncate(largeArtist,49)),largeAlbum.length>66&&(largeAlbum=truncate(largeAlbum,66)),$(`#card${cardNumber} .card-body h4`).html(`<span class="large_artist">${largeArtist}</span><span class="small_artist">${smallArtist}</span>`),$(`#card${cardNumber} .card-body .album`).html(`<span class="large_album">${largeAlbum}</span><span class="small_album">${smallAlbum}</span>`),$(`#card${cardNumber} img`).attr("src",album.cover.replace("{w}",260).replace("{h}",260)),$(`#card${cardNumber} .album_details_link`).attr("href",`/album/${album.appleAlbumID}`),$(`#card${cardNumber}`).append(`<span class="album-delete-button" data-album-id="${album.appleAlbumID}" data-toggle="tooltip" data-placement="right" title="Remove from list" data-trigger="hover">&#10005;</span></li>`),userID&&!isFavoritesList?$(".album-delete-button").show():$(".album-delete-button").hide()}function populateList(){$("#no-albums-message").hide(),$("#albums").html("");let listCreator=listData.displayName;if(listCreator&&""!==listCreator.trim||(listCreator="Unknown"),$("#list-title").text(`${listData.title}`),$("#list-title").append('<small class="text-secondary pl-2 page-info-button" data-toggle="modal" data-target="#pageInfoModal">&#9432;</small>'),$("#list-creator").text("by: "+listCreator),listData.albums&&listData.albums.length>0){let card=0;listData.albums.forEach(albumObject=>{createCard(card+=1),populateCard(albumObject.album||albumObject,card)}),$(".album-delete-button").on("click",function(){removeAlbum($(this).attr("data-album-id"))})}else $("#no-albums-message").show();isFavoritesList&&$("#edit-button").hide()}function removeAlbum(albumID){let thisAlbum=listData.albums.find(x=>x.appleAlbumID===albumID),confirmed;if(confirm(`Are you sure you want to remove "${thisAlbum.title}" from this list? You cannot undo this operation.`)){let deleteObject={method:"remove album",appleAlbumID:thisAlbum.appleAlbumID,title:thisAlbum.title,artist:thisAlbum.artist,releaseDate:thisAlbum.releaseDate,cover:thisAlbum.cover};$.ajax({method:"PUT",url:"/api/v1/list/"+listID,contentType:"application/json",data:JSON.stringify(deleteObject),success:function(data){listData=data,populateList()}})}}function editDisplayName(){let newDisplayName=$("#list-display-name-input").val().trim();if(newDisplayName===listData.displayName)return void alert(`The display name for this list is already set as "${listData.displayName}"`);if(newDisplayName.length>30)return void alert("Display names must be shorter than 30 characters in length.");let updateObject={method:"change display name",displayName:newDisplayName};$.ajax({method:"PUT",url:"/api/v1/list/"+listID,contentType:"application/json",data:JSON.stringify(updateObject),success:function(data){data.message?alert(data.message):(listData=data,populateList(),$("#list-update-success").text("List info updated!"),setTimeout(function(){$("#list-update-success").html("&nbsp;")},3e3))}})}function editListTitle(){let newListTitle=$("#list-title-input").val().trim();if(newListTitle!==listData.title)if(newListTitle.length>60)alert("List titles must be shorter than 60 characters in length.");else if(newListTitle&&newListTitle.length>0){let updateObject={method:"change title",title:newListTitle};$.ajax({method:"PUT",url:"/api/v1/list/"+listID,contentType:"application/json",data:JSON.stringify(updateObject),success:function(data){data.message?alert(data.message):(listData=data,populateList(),$("#list-update-success").text("List info updated!"),setTimeout(function(){$("#list-update-success").html("&nbsp;")},3e3))}})}else alert("A non-blank title is required for every list."),$("#list-title-input").val(listData.title);else alert(`The title for this list is already "${listData.title}"`)}document.getElementById("edit-button").addEventListener("click",function(){$("#editListModal").modal("show"),$("#list-title-input").val(listData.title),$("#list-display-name-input").val(listData.displayName||"Unknown")}),$("#list-title-input").keyup(function(event){13===event.keyCode&&$("#update-list-title").click()}),$("#list-display-name-input").keyup(function(event){13===event.keyCode&&$("#update-list-display-name").click()}),document.getElementById("update-list-display-name").addEventListener("click",editDisplayName),document.getElementById("update-list-title").addEventListener("click",editListTitle);const config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config);let userID=!1;function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var provider=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(provider)}).then(function(result){userID=user.uid,getList(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show(),$("#edit-button").show(),$(".album-delete-button").show()}).catch(function(error){})}function logOut(){firebase.auth().signOut().then(function(){userID=!1,$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide(),$("#edit-button").hide(),$(".album-delete-button").hide()}).catch(function(error){})}firebase.auth().onAuthStateChanged(function(user){user?(userID=firebase.auth().currentUser.uid,getList(),$("#full_menu_login_logout_container").show(),$("#login_button").hide(),$("#full_menu_login_button").hide(),$("#logout_button").show(),$("#full_menu_logout_button").show(),$("#edit-button").show(),$(".album-delete-button").show()):(userID=!1,getList(),$("#full_menu_login_logout_container").show(),$("#login_button").show(),$("#full_menu_login_button").show(),$("#logout_button").hide(),$("#full_menu_logout_button").hide(),$("#loader").hide(),$("#edit-button").hide(),$(".album-delete-button").hide())});const loginButton=document.getElementById("login_button"),loginButton2=document.getElementById("full_menu_login_button"),logoutButton=document.getElementById("logout_button"),logoutButton2=document.getElementById("full_menu_logout_button");loginButton.addEventListener("click",logIn),loginButton2.addEventListener("click",logIn),logoutButton.addEventListener("click",logOut),logoutButton2.addEventListener("click",logOut),$(".login_button").on("click",logIn);