var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};
$jscomp.polyfill=function(a,b,c,e){if(b){c=$jscomp.global;a=a.split(".");for(e=0;e<a.length-1;e++){var d=a[e];d in c||(c[d]={});c=c[d]}a=a[a.length-1];e=c[a];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function c(a){return a instanceof d?a:new d(function(b,c){b(a)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var b=this;this.asyncExecuteFunction(function(){b.executeBatch_()})}this.batch_.push(a)};var e=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){e(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];a[b]=null;try{c()}catch(l){this.asyncThrow_(l)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(k){b.reject(k)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(k){this.reject_(k);return}"function"==typeof b?
this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)f.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var f=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(l){c.reject(l)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(n){f(n)}}:b}var e,f,h=new d(function(a,b){e=a;f=b});this.callWhenSettled_(c(a,e),c(b,f));return h};
d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?f.asyncExecute(c):this.onSettledCallbacks_.push(c)};d.resolve=c;d.reject=function(a){return new d(function(b,c){c(a)})};d.race=function(a){return new d(function(b,d){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())c(f.value).callWhenSettled_(b,
d)})};d.all=function(a){var b=$jscomp.makeIterator(a),e=b.next();return e.done?c([]):new d(function(a,d){function f(b){return function(c){h[b]=c;g--;0==g&&a(h)}}var h=[],g=0;do h.push(void 0),g++,c(e.value).callWhenSettled_(f(h.length-1),d),e=b.next();while(!e.done)})};return d},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.Symbol=function(){var a=0;return function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+a++}}();$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.underscoreProtoCanBeSet=function(){var a={a:!0},b={};try{return b.__proto__=a,b.a}catch(c){}return!1};
$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(a,b){a.__proto__=b;if(a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(a){if(!(a instanceof Object))throw new TypeError("Iterator result "+a+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(a){this.yieldResult=a};$jscomp.generator.Context.prototype.throw_=function(a){this.abruptCompletion_={exception:a,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(a){this.abruptCompletion_={return:a};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(a){this.abruptCompletion_={jumpTo:a};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(a,b){this.nextAddress=b;return{value:a}};$jscomp.generator.Context.prototype.yieldAll=function(a,b){a=$jscomp.makeIterator(a);var c=a.next();$jscomp.generator.ensureIteratorResultIsObject_(c);if(c.done)this.yieldResult=c.value,this.nextAddress=b;else return this.yieldAllIterator_=a,this.yield(c.value,b)};
$jscomp.generator.Context.prototype.jumpTo=function(a){this.nextAddress=a};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(a,b){this.catchAddress_=a;void 0!=b&&(this.finallyAddress_=b)};$jscomp.generator.Context.prototype.setFinallyBlock=function(a){this.catchAddress_=0;this.finallyAddress_=a||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(a,b){this.nextAddress=a;this.catchAddress_=b||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(a){this.catchAddress_=a||0;a=this.abruptCompletion_.exception;this.abruptCompletion_=null;return a};$jscomp.generator.Context.prototype.enterFinallyBlock=function(a,b,c){c?this.finallyContexts_[c]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=a||0;this.finallyAddress_=b||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(a,b){b=this.finallyContexts_.splice(b||0)[0];if(b=this.abruptCompletion_=this.abruptCompletion_||b){if(b.isException)return this.jumpToErrorHandler_();void 0!=b.jumpTo&&this.finallyAddress_<b.jumpTo?(this.nextAddress=b.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=a};$jscomp.generator.Context.prototype.forIn=function(a){return new $jscomp.generator.Context.PropertyIterator(a)};
$jscomp.generator.Context.PropertyIterator=function(a){this.object_=a;this.properties_=[];for(var b in a)this.properties_.push(b);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var a=this.properties_.pop();if(a in this.object_)return a}return null};$jscomp.generator.Engine_=function(a){this.context_=new $jscomp.generator.Context;this.program_=a};
$jscomp.generator.Engine_.prototype.next_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,a,this.context_.next_);this.context_.next_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(a){this.context_.start_();var b=this.context_.yieldAllIterator_;if(b)return this.yieldAllStep_("return"in b?b["return"]:function(a){return{value:a,done:!0}},a,this.context_.return);this.context_.return(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(a){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],a,this.context_.next_);this.context_.throw_(a);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(a,b,c){try{var e=a.call(this.context_.yieldAllIterator_,b);$jscomp.generator.ensureIteratorResultIsObject_(e);if(!e.done)return this.context_.stop_(),e;var d=e.value}catch(f){return this.context_.yieldAllIterator_=null,this.context_.throw_(f),this.nextStep_()}this.context_.yieldAllIterator_=null;c.call(this.context_,d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var a=this.program_(this.context_);if(a)return this.context_.stop_(),{value:a.value,done:!1}}catch(b){this.context_.yieldResult=void 0,this.context_.throw_(b)}this.context_.stop_();if(this.context_.abruptCompletion_){a=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(a.isException)throw a.exception;return{value:a.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(a){this.next=function(b){return a.next_(b)};this.throw=function(b){return a.throw_(b)};this.return=function(b){return a.return_(b)};$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(a,b){b=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(b));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(b,a.prototype);return b};
$jscomp.asyncExecutePromiseGenerator=function(a){function b(b){return a.next(b)}function c(b){return a.throw(b)}return new Promise(function(e,d){function f(a){a.done?e(a.value):Promise.resolve(a.value).then(b,c).then(f,d)}f(a.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(a){return $jscomp.asyncExecutePromiseGenerator(a())};$jscomp.asyncExecutePromiseGeneratorProgram=function(a){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(a)))};
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var e=a.length,d=0;d<e;d++){var f=a[d];if(b.call(c,f,d,a))return{i:d,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");function truncate(a,b){a=a.substr(0,b-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}
function scrollToTop(){document.body.scrollTop=0;document.documentElement.scrollTop=0}function isGenre(a){return-1!=="Metalcore;Pop Punk;Emo;Rock;Post-Hardcore;Accoustic;Screamo;Metal;Nu Metal;Alt Metal;Djent;Accoustic;Jazz;Ska;Rap-Rock;Progressive;Punk;Rap".split(";").indexOf(a)}function removeFromArray(a,b){-1!==a.indexOf(b)&&a.splice(a.indexOf(b),1)}function addToArray(a,b){-1===a.indexOf(b)&&a.push(b)}
function escapeHtml(a){var b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;","/":"&sol;","\\":"&#92;","{":"&#123;","}":"&#125;"};return a.replace(/[<>"'/\\{}]/g,function(a){return b[a]})}function addClassEventListener(a,b,c){a=document.getElementsByClassName(a);for(var e=0;e<a.length;e++)a[e].addEventListener(b,c)}function stringToNode(a){var b=document.createElement("template");b.innerHTML=a;return b.content.firstChild}
function showClass(a){a=document.getElementsByClassName(a);for(var b=0;b<a.length;b++)a[b].classList.remove("hide_me")}function hideClass(a){a=document.getElementsByClassName(a);for(var b=0;b<a.length;b++)a[b].classList.add("hide_me")}
function removeSelectedElement(a){if("."===a[0]){a=document.querySelectorAll(a);for(var b=0;b<a.length;b++)a[b].parentNode.removeChild(a[b])}else"#"===a[0]?(a=document.getElementById(a.substring(1)))&&a.parentNode.removeChild(a):console.error("removeSelectedElement() was passed an invalid selector")}var listData,listType,listID,tagSearch,startingURL=new URL(document.location),totalAlbumsOnPage=0;
"/list"===startingURL.pathname?(listType=startingURL.searchParams.get("type"),listID=startingURL.searchParams.get("id"),tagSearch=startingURL.searchParams.get("search")):"/myfavorites"===startingURL.pathname&&(listType="myfavorites");
function getList(){var a,b,c,e,d,f,h,m,k,l;return $jscomp.asyncExecutePromiseGeneratorProgram(function(g){switch(g.nextAddress){case 1:if("favorites"===listType)return g.yield(fetch("/api/v1/favorite/virtual/"+listID),15);if("userlist"===listType)return g.yield(fetch("/api/v1/list/"+listID),13);if("myfavorites"===listType)return g.yield(fetch("/api/v1/favorite/"+userID),11);if("tagsearch"!==listType){g.jumpTo(0);break}a=[];b="";decodeURIComponent(tagSearch).split(",").forEach(function(c){a.push(escapeHtml(c));
b+='<a href="/list?type=tagsearch&search='+encodeURIComponent(c)+'" class="badge badge-light text-secondary mr-1 tagsearch-tag" data-toggle="tooltip" data-placement="top" title="Search for albums with just this tag" data-trigger="hover">'+escapeHtml(c)+"</a>"});document.getElementById("no-albums-message").innerHTML="No albums match this combination of tags. Go <a href='/alltags'>back</a> to try another search, or click one of the tags above to search just that tag.";return g.yield(fetch("/api/v1/tag/"+
a),9);case 9:c=g.yieldResult;if(!c.ok)throw Error(c.statusText);return g.yield(c.json(),10);case 10:e=g.yieldResult;e.message&&(e=[]);listData={user:userID||null,displayName:"All Users",title:"Tags: "+b,albums:e};document.getElementById("main-page-loader").classList.add("hide_me");populateList();g.jumpTo(0);break;case 11:d=g.yieldResult;if(!d.ok)throw Error(d.statusText);return g.yield(d.json(),12);case 12:f=g.yieldResult;listData=f.message&&"This user does not have any favorited albums."===f.message?
[]:{user:userID,displayName:"You!",title:"My Favorites",albums:f};document.getElementById("main-page-loader").classList.add("hide_me");populateList();g.jumpTo(0);break;case 13:h=g.yieldResult;if(!h.ok)throw Error(h.statusText);return g.yield(h.json(),14);case 14:m=g.yieldResult;m.message?alert(m.message):(listData=m,document.getElementById("main-page-loader").classList.add("hide_me"),populateList());g.jumpTo(0);break;case 15:k=g.yieldResult;if(!k.ok)throw Error(k.statusText);return g.yield(k.json(),
16);case 16:l=g.yieldResult,l.message?alert(l.message):(listData=l,document.getElementById("main-page-loader").classList.add("hide_me"),populateList()),g.jumpToEnd()}})}
function showAppliedFilter(a,b){document.getElementById("applied-filters").classList.remove("hide_me");var c=escapeHtml(a);c=24<c.length?truncate(c,24):c;document.getElementById("applied-filters").appendChild(stringToNode('<span class="badge badge-primary mr-1 applied-filter applied-filter-'+b+'" data-'+b+'="'+a+'">'+c+"</span>"));addClassEventListener("applied-filter-"+b,"click",function(){toggleFilter(b,this.dataset[b])})}
function showAlbumCount(){var a=sessionStorage.getItem("hideCount");if(!a){removeSelectedElement("#result-count");var b="("+totalAlbumsOnPage+" "+(1<totalAlbumsOnPage||0===totalAlbumsOnPage?"albums":"album")+")";document.getElementById("applied-filters").appendChild(stringToNode('<small id="result-count">'+b+"</small>"));document.getElementById("applied-filters").classList.remove("hide_me")}a&&1>document.getElementsByClassName("applied-filter").length&&document.getElementById("applied-filters").classList.add("hide_me")}
function createCard(a){document.getElementById("albums").appendChild(stringToNode('<div id="card'+a+'" class="card list-card"><a class="album-details-link" href=""><img class="card-img-top" src=""><a/><div class="card-body"><h4 class="card-title"></h4><span class="album-title"></span></div></div>'))}
function populateCard(a,b){var c=32<a.artist.length?truncate(a.artist,32):a.artist,e=49<a.artist.length?truncate(a.artist,49):a.artist,d=44<a.title.length?truncate(a.title,44):a.title,f=66<a.title.length?truncate(a.title,66):a.title;document.querySelector("#card"+b+" .card-body h4").innerHTML='<span class="large_artist">'+e+'</span><span class="small_artist">'+c+"</span>";document.querySelector("#card"+b+" .card-body .album-title").innerHTML='<span class="large_album">'+f+'</span><span class="small_album">'+
d+"</span>";document.querySelector("#card"+b+" .card-img-top").src=a.cover.replace("{w}",260).replace("{h}",260);document.querySelector("#card"+b+" .album-details-link").href="/album/"+a.appleAlbumID;document.getElementById("card"+b).appendChild(stringToNode('<span class="album-delete-button" data-album-id="'+a.appleAlbumID+'" data-toggle="tooltip" data-placement="right" title="Remove from list" data-trigger="hover">&#10005;</span></li>'));listData.user!==userID||"userlist"!==listType&&"myfavorites"!==
listType?hideClass("album-delete-button"):showClass("album-delete-button")}
function populateList(){var a=document.getElementById("page-info-button");a&&a.classList.add("hide_me");document.getElementById("no-albums-message").classList.add("hide_me");document.getElementById("albums").innerHTML="";totalAlbumsOnPage=0;(a=listData.displayName)&&""!==a.trim||(a="Unknown");document.getElementById("list-title").innerHTML=""+listData.title;document.getElementById("list-title").parentNode.insertBefore(stringToNode('<h5 id="page-info-button" class="text-secondary" data-toggle="modal" data-target="#pageInfoModal">&#9432;</h5>'),document.getElementById("list-title").nextSibling);
document.getElementById("page-info-button").addEventListener("click",function(){(new Modal(document.getElementById("pageInfoModal"))).show()});"userlist"!==listType&&document.getElementById("page-info-button").classList.add("hide_me");document.getElementById("list-creator").innerText="by: "+a;if(listData.albums&&0<listData.albums.length){a=filterAlbums();0<a.length?document.getElementById("no-albums-message").classList.add("hide_me"):(clearFilters(),a=filterAlbums(),0<a.length?(document.getElementById("no-albums-message").classList.add("hide_me"),
document.getElementById("albums").innerHTML=""):document.getElementById("no-albums-message").classList.remove("hide_me"));for(var b=0;b<a.length;b++){var c=a[b],e=b+1;createCard(e);populateCard(c,e)}totalAlbumsOnPage=a.length;addClassEventListener("album-delete-button","click",function(){if(listData.user!==userID)return alert("Sorry! Only the list creator can delete albums.");if("userlist"===listType)removeFromList(this.dataset.albumId);else if("myfavorites"===listType)removeFromFavorites(this.dataset.albumId);
else return alert("Sorry! This type of list won't let you delete albums.")});populateFilters(a)}else document.getElementById("no-albums-message").classList.remove("hide_me"),populateFilters([]);displayButtons();showAlbumCount()}
function removeFromList(a){var b,c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress){if(listData.user!==userID)return alert("Sorry, only the list creator can delete albums from a list."),f.return();b=listData.albums.find(function(b){return b.appleAlbumID==a});c=confirm('Are you sure you want to remove "'+b.title+'" from this list? You cannot undo this operation.');if(!c)return f.jumpTo(0);e={method:"remove album",appleAlbumID:b.appleAlbumID,title:b.title,artist:b.artist,
releaseDate:b.releaseDate,cover:b.cover,genres:b.genres};return f.yield(fetch("/api/v1/list/"+listID,{method:"put",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),3)}if(4!=f.nextAddress){d=f.yieldResult;if(!d.ok)throw Error(d.statusText);return f.yield(d.json(),4)}removeFromArray(listData.albums,b);populateList();f.jumpToEnd()})}
function editDisplayName(){var a,b,c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress){a=document.getElementById("list-display-name-input").value.trim();if(a===listData.displayName)return d.return(alert('The display name for this list is already set as "'+listData.displayName+'"'));if(30<a.length)return d.return(alert("Display names must be shorter than 30 characters in length."));b={method:"change display name",displayName:a};return d.yield(fetch("/api/v1/list/"+
listID,{method:"put",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),2)}if(3!=d.nextAddress){c=d.yieldResult;if(!c.ok)throw Error(c.statusText);return d.yield(c.json(),3)}e=d.yieldResult;listData.displayName=e.displayName;populateList();document.getElementById("list-update-success").innerHTML="List info updated! &#10003;";setTimeout(function(){document.getElementById("list-update-success").innerHTML="&nbsp;"},3E3);d.jumpToEnd()})}
function editListTitle(){var a,b,c,e;return $jscomp.asyncExecutePromiseGeneratorProgram(function(d){if(1==d.nextAddress){a=document.getElementById("list-title-input").value.trim();if(a===listData.title)return d.return(alert('The title for this list is already "'+listData.title+'"'));if(60<a.length)return d.return(alert("List titles must be shorter than 60 characters in length."));if(!(a&&0<a.length))return alert("A non-blank title is required for every list."),document.getElementById("list-title-input").value=
listData.title,d.jumpTo(0);b={method:"change title",title:a};return d.yield(fetch("/api/v1/list/"+listID,{method:"put",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}),3)}if(4!=d.nextAddress){c=d.yieldResult;if(!c.ok)throw Error(c.statusText);return d.yield(c.json(),4)}e=d.yieldResult;listData.title=e.title;populateList();document.getElementById("list-update-success").innerHTML="List info updated! &#10003;";setTimeout(function(){document.getElementById("list-update-success").innerHTML=
"&nbsp;"},3E3);d.jumpToEnd()})}var addAlbumResults=[];
function populateAddToListModalResults(a){document.getElementById("add-album-search-results").innerHTML="";document.querySelector("#add-album-card-body .new-loader").classList.add("hide_me");if(a.albums&&0<a.albums.length){addAlbumResults=a.albums;for(var b=0;b<a.albums.length;b++){var c=a.albums[b],e=b+1;addPageModalCard("add-album-search-results","addAlbum",e);populatePageModalCard("addAlbum",addToList,addAlbumResults,c,e)}document.getElementById("add-album-search-results").appendChild(stringToNode('<div id="add-search-modal-placeholder">&nbsp;</div>'))}else document.getElementById("add-album-search-results").parentNode.insertBefore(stringToNode('<div id="no-results-message" class="text-primary" style="text-align:center;">It looks like no albums matched your search terms. Try a different search!</div>'),document.getElementById("add-album-search-results").nextSibling)}
function addPageModalCard(a,b,c){document.getElementById(""+a).appendChild(stringToNode('<div id="'+b+"ModalCard"+c+'" class="search-modal-card" data-result-index="'+(c-1)+'"><img class="search-modal-card-image" src="" alt=""><div class="search-modal-card-body"><h4 class="search-modal-card-title"></h4><span class="search-modal-card-album"></span></div></div>'))}
function populatePageModalCard(a,b,c,e,d){var f=32<e.artist.length?truncate(e.artist,32):e.artist,h=49<e.artist.length?truncate(e.artist,49):e.artist,m=44<e.title.length?truncate(e.title,44):e.title,k=66<e.title.length?truncate(e.title,66):e.title;document.querySelector("#"+a+"ModalCard"+d+" .search-modal-card-title").innerHTML='<span class="search-modal-card-large-artist">'+h+'</span><span class="search-modal-card-small-artist">'+f+"</span>";document.querySelector("#"+a+"ModalCard"+d+" .search-modal-card-album").innerHTML=
'<span class="search-modal-card-large-album">'+k+'</span><span class="search-modal-card-small-album">'+m+"</span>";document.querySelector("#"+a+"ModalCard"+d+" .search-modal-card-image").src=e.cover.replace("{w}",260).replace("{h}",260);document.getElementById(a+"ModalCard"+d).addEventListener("click",function(){b(c[this.dataset.resultIndex])})}
function addToList(a){var b,c,e,d,f;return $jscomp.asyncExecutePromiseGeneratorProgram(function(h){if(1==h.nextAddress){if(!a)return h.jumpTo(0);b=parseInt(a.appleAlbumID);if(c=listData.albums.find(function(a){return a.appleAlbumID===b}))return h.return(alert('"'+a.title+'" is already in this list.'));e={method:"add album",appleAlbumID:a.appleAlbumID,title:a.title,artist:a.artist,releaseDate:a.releaseDate,cover:a.cover,genres:a.genres,appleURL:a.appleURL,recordCompany:a.recordCompany};return h.yield(fetch("/api/v1/list/"+
listData.id,{method:"put",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),3)}if(4!=h.nextAddress){d=h.yieldResult;if(!d.ok)throw Error(d.statusText);return h.yield(d.json(),4)}listData.albums.push(a);f=new Modal(document.getElementById("editListModal"));f.hide();populateList();h.jumpToEnd()})}
function toggleActiveInfoTab(a){var b=document.querySelector("#editListModal .active");b.classList.remove("active");b.classList.add("inactive-list-edit-tab");document.getElementById(a).classList.remove("inactive-list-edit-tab");document.getElementById(a).classList.add("active");hideClass("edit-list-card-body");a=document.getElementById(a).dataset.card;document.getElementById(a+"-card-body").classList.remove("hide_me")}
function getCleanAlbumArray(a){var b=[];a.forEach(function(a){a.album?b.push(a.album):b.push(a)});b.forEach(function(a){a.tagObjects&&(a.tagGenres=[],a.tagObjects.forEach(function(b){b.creator===listData.user&&(isGenre(b.text)||b.customGenre)&&-1===a.tagGenres.indexOf(b.text)&&a.tagGenres.push(b.text)}));a.year=a.releaseDate.slice(0,4)});return b}
function getFilterObject(){return{year:(new URL(document.location)).searchParams.get("year"),artist:(new URL(document.location)).searchParams.get("artist"),genre:(new URL(document.location)).searchParams.get("genre")}}
function filterAlbums(){removeSelectedElement(".applied-filter");var a=getFilterObject(),b=getCleanAlbumArray(listData.albums);a.genre&&(b=b.filter(function(b){return b.tagGenres?-1!==b.tagGenres.indexOf(a.genre):!1}),showAppliedFilter(a.genre,"genre"));a.artist&&(b=b.filter(function(b){return!!b.artist&&b.artist===a.artist}),showAppliedFilter(a.artist,"artist"));a.year&&(b=b.filter(function(b){return!!b.year&&b.year===a.year}),showAppliedFilter(a.year,"year"));b=b.sort(function(a,b){return a.releaseDate>
b.releaseDate?1:-1});return b=b.reverse()}var artistFilterElements;
function populateFilters(a){var b=getFilterObject();document.getElementById("year-filter-dropdown").innerHTML="";document.getElementById("artist-filter-dropdown").innerHTML="";document.getElementById("genre-filter-dropdown").innerHTML="";if(1>a.length)return hideClass("remove-if-no-albums");showClass("remove-if-no-albums");var c=[];a.forEach(function(a){addToArray(c,a.releaseDate.slice(0,4))});c.sort().reverse();c.forEach(function(a){b.year&&a===b.year?document.getElementById("year-filter-dropdown").appendChild(stringToNode('<span class="badge badge-primary year-filter" data-year="'+
a+'">'+a+"</span>")):document.getElementById("year-filter-dropdown").appendChild(stringToNode('<span class="badge badge-light year-filter" data-year="'+a+'">'+a+"</span>"))});addClassEventListener("year-filter","click",function(){toggleFilter("year",this.dataset.year)});var e=[];a.forEach(function(a){addToArray(e,a.artist)});e.sort();e.forEach(function(a){b.artist&&a===b.artist?document.getElementById("artist-filter-dropdown").appendChild(stringToNode('<span class="badge badge-primary artist-filter" data-artist="'+
a+'">'+(32<a.length?truncate(a,32):a)+"</span>")):document.getElementById("artist-filter-dropdown").appendChild(stringToNode('<span class="badge badge-light artist-filter" data-artist="'+a+'">'+(32<a.length?truncate(a,32):a)+"</span>"))});addClassEventListener("artist-filter","click",function(){toggleFilter("artist",this.dataset.artist)});12<e.length&&(document.getElementById("artist-filter-dropdown").prepend(stringToNode('<input id="artist-tag-filter-input" type="search" placeholder="Filter artist tags..." class="form-control"></input>')),
artistFilterElements=document.getElementsByClassName("artist-filter"),document.getElementById("artist-tag-filter-input").addEventListener("click",function(a){a.stopPropagation()}),document.getElementById("artist-tag-filter-input").addEventListener("input",searchFilter));var d=[];a.forEach(function(a){a.tagGenres&&a.tagGenres.forEach(function(a){addToArray(d,a)})});1>d.length?document.getElementById("filter-by-genre-button").classList.add("hide_me"):document.getElementById("filter-by-genre-button").classList.remove("hide_me");
d.sort();d.forEach(function(a){b.genre&&a===b.genre?document.getElementById("genre-filter-dropdown").appendChild(stringToNode('<span class="badge badge-primary genre-filter" data-genre="'+a+'">'+(32<a.length?truncate(a,32):a)+"</span>")):b.genre||document.getElementById("genre-filter-dropdown").appendChild(stringToNode('<span class="badge badge-light genre-filter" data-genre="'+a+'">'+(32<a.length?truncate(a,32):a)+"</span>"))});addClassEventListener("genre-filter","click",function(){toggleFilter("genre",
this.dataset.genre)})}function searchFilter(){userInput=document.getElementById("artist-tag-filter-input").value.toUpperCase();if(0==userInput.trim().length)for(var a=0;a<artistFilterElements.length;a++)artistFilterElements[a].style.display="";else for(a=0;a<artistFilterElements.length;a++)-1!=artistFilterElements[a].dataset.artist.toUpperCase().indexOf(userInput)?artistFilterElements[a].style.display="":artistFilterElements[a].style.display="none"}
function toggleFilter(a,b){var c=new URL(document.location);c.searchParams.get(a)==b?c.searchParams.delete(a):c.searchParams.set(a,b);history.replaceState({},"",c);populateList()}function clearFilters(){var a=new URL(document.location);a.searchParams.delete("year");a.searchParams.delete("artist");a.searchParams.delete("genre");history.replaceState({},"",a);populateList()}document.getElementById("clear-filters-button").addEventListener("click",clearFilters);var addFavoritesAlbumResults=[];
function populateAddToFavoritesModalResults(a){document.getElementById("favorites-search-results").innerHTML="";document.querySelector("#addFavoritesAlbumModal .new-loader").classList.add("hide_me");if(a.albums&&0<a.albums.length){addFavoritesAlbumResults=a.albums;for(var b=0;b<a.albums.length;b++){var c=a.albums[b],e=b+1;addPageModalCard("favorites-search-results","addFavorites",e);populatePageModalCard("addFavorites",addToFavorites,addFavoritesAlbumResults,c,e)}document.getElementById("favorites-search-results").appendChild(stringToNode('<div id="add-search-modal-placeholder">&nbsp;</div>'))}else document.getElementById("favorites-search-results").parentNode.insertBefore(stringToNode('<div id="no-results-message" class="text-primary mb-3" style="text-align:center;">It looks like no albums matched your search terms. Try a different search!</div>'),
document.getElementById("favorites-search-results").nextSibling)}document.getElementById("add-favorites-album-button").addEventListener("click",function(){var a=document.getElementById("add-favorites-album-input").value.trim().replace(/[^\w\s]/gi,"");removeSelectedElement("#no-results-message");document.getElementById("favorites-search-results").innerHTML="";document.querySelector("#addFavoritesAlbumModal .new-loader").classList.remove("hide_me");executeSearch(a,"add to favorites")});
document.getElementById("add-favorites-album-input").addEventListener("keyup",function(a){13===a.keyCode&&document.getElementById("add-favorites-album-button").click()});
function addToFavorites(a){var b,c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return b=parseInt(a.appleAlbumID),(c=listData.albums.find(function(a){return a.appleAlbumID===b}))?f.return(alert('"'+a.title+'" is already in your favorites.')):a&&userID?f.yield(fetch("/api/v1/favorite",{method:"post",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({user:userID,album:a})}),3):f.jumpTo(0);if(4!=f.nextAddress){e=f.yieldResult;
if(!e.ok)throw Error(e.statusText);return f.yield(e.json(),4)}listData.albums.push(a);d=new Modal(document.getElementById("addFavoritesAlbumModal"));d.hide();document.getElementById("add-favorites-album-input").value="";document.getElementById("favorites-search-results").innerHTML="";populateList();f.jumpToEnd()})}
function removeFromFavorites(a){var b,c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress){if(listData.user!==userID)return f.return(alert("Sorry, only the list creator can delete albums from a list."));b=listData.albums.find(function(b){return b.appleAlbumID==a});return(c=confirm('Are you sure you want to remove "'+b.title+'" from your favorites? You cannot undo this operation.'))&&b?f.yield(fetch("/api/v1/favorite",{method:"delete",credentials:"same-origin",
headers:{"Content-Type":"application/json"},body:JSON.stringify({user:userID,appleAlbumID:b.appleAlbumID,returnData:"list"})}),3):f.jumpTo(0)}if(4!=f.nextAddress){e=f.yieldResult;if(!e.ok)throw Error(e.statusText);return f.yield(e.json(),4)}d=f.yieldResult;d.message&&"Album successfully removed from user favorites."!==d.message?alert(d.message):(listData.albums=d,populateList());f.jumpToEnd()})}
document.getElementById("favorites-display-name-input").addEventListener("keyup",function(a){13===a.keyCode&&document.getElementById("get-shareable-link").click()});
document.getElementById("get-shareable-link").addEventListener("click",function(){var a,b,c,e,d;return $jscomp.asyncExecutePromiseGeneratorProgram(function(f){if(1==f.nextAddress)return a=document.getElementById("favorites-display-name-input").value.trim(),f.yield(fetch("/api/v1/favorite/virtual/"+userID,{method:"post",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({displayName:a})}),2);if(3!=f.nextAddress){b=f.yieldResult;if(!b.ok)throw Error(b.statusText);
return f.yield(b.json(),3)}c=f.yieldResult;e=window.location.protocol+"//"+window.location.host+"/list?type=favorites&id="+c;d=document.getElementById("shareable-url");d.value=e;d.select();navigator.clipboard.writeText(e).then(function(){document.getElementById("copied-message").classList.remove("hide_me");setTimeout(function(){document.getElementById("copied-message").classList.add("hide_me")},3E3)},function(){});f.jumpToEnd()})});
document.getElementById("add-album-modal-button").addEventListener("click",function(){var a=document.getElementById("add-album-modal-input").value.trim().replace(/[^\w\s]/gi,"");document.getElementById("add-album-search-results").innerHTML="";removeSelectedElement("#no-results-message");document.querySelector("#add-album-card-body .new-loader").classList.remove("hide_me");executeSearch(a,"add to list")});document.getElementById("share-favorites-button").addEventListener("click",function(){(new Modal(document.getElementById("shareFavoritesModal"))).show()});
document.getElementById("add-album-modal-input").addEventListener("keyup",function(a){13===a.keyCode&&document.getElementById("add-album-modal-button").click()});
document.getElementById("edit-button").addEventListener("click",function(){if(listData.user!==userID)return alert("Sorry! Only the list creator can edit the information for this list.");toggleActiveInfoTab("edit-list-modal-nav-tab");(new Modal(document.getElementById("editListModal"))).show();document.getElementById("list-title-input").value=listData.title;document.getElementById("list-display-name-input").value=listData.displayName||"Unknown"});
document.getElementById("add-album-button").addEventListener("click",function(){if(listData.user!==userID)return alert("Sorry! Only the list creator can add albums to this list.");"userlist"===listType?(toggleActiveInfoTab("add-album-modal-nav-tab"),(new Modal(document.getElementById("editListModal"))).show(),document.getElementById("list-title-input").value=listData.title,document.getElementById("list-display-name-input").value=listData.displayName||"Unknown"):"myfavorites"===listType&&(new Modal(document.getElementById("addFavoritesAlbumModal"))).show()});
addClassEventListener("add-album-refrence","click",function(){(new Modal(document.getElementById("pageInfoModal"))).hide();document.getElementById("add-album-button").click()});addClassEventListener("edit-list-refrence","click",function(){(new Modal(document.getElementById("pageInfoModal"))).hide();document.getElementById("edit-button").click()});document.getElementById("list-title-input").addEventListener("keyup",function(a){13===a.keyCode&&document.getElementById("update-list-title").click()});
document.getElementById("list-display-name-input").addEventListener("keyup",function(a){13===a.keyCode&&document.getElementById("update-list-display-name").click()});document.getElementById("update-list-display-name").addEventListener("click",editDisplayName);document.getElementById("update-list-title").addEventListener("click",editListTitle);document.getElementById("to-top-button").addEventListener("click",scrollToTop);
document.addEventListener("scroll",function(){document.getElementById("year-filter-dropdown").classList.remove("show");document.getElementById("genre-filter-dropdown").classList.remove("show");document.getElementById("artist-filter-dropdown").classList.remove("show")});var config={apiKey:"AIzaSyAoadL6l7wVMmMcjqqa09_ayEC8zwnTyrc",authDomain:"album-tags-v1d1.firebaseapp.com",projectId:"album-tags-v1d1"},defaultApp=firebase.initializeApp(config),userID=!1;
firebase.auth().onAuthStateChanged(function(a){a?(userID=firebase.auth().currentUser.uid,getList(),document.getElementById("full_menu_login_logout_container").classList.remove("hide_me"),document.getElementById("login_button").classList.add("hide_me"),document.getElementById("full_menu_login_button").classList.add("hide_me"),document.getElementById("logout_button").classList.remove("hide_me"),document.getElementById("full_menu_logout_button").classList.remove("hide_me"),document.getElementById("log_in_message").classList.add("hide_me")):
(userID=!1,document.getElementById("full_menu_login_logout_container").classList.remove("hide_me"),document.getElementById("login_button").classList.remove("hide_me"),document.getElementById("full_menu_login_button").classList.remove("hide_me"),document.getElementById("logout_button").classList.add("hide_me"),document.getElementById("full_menu_logout_button").classList.add("hide_me"),document.getElementById("main-page-loader").classList.add("hide_me"),"myfavorites"===listType?(document.getElementById("no-albums-message").classList.add("hide_me"),
document.getElementById("log_in_message").classList.remove("hide_me"),document.getElementById("list-title").innerText="My Favorites",document.getElementById("list-creator").innerText="You!",displayButtons()):getList())});
function logIn(){firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var a=new firebase.auth.GoogleAuthProvider;return firebase.auth().signInWithPopup(a)}).then(function(a){userID=user.uid;populateList();document.getElementById("full_menu_login_logout_container").classList.remove("hide_me");document.getElementById("login_button").classList.add("hide_me");document.getElementById("full_menu_login_button").classList.add("hide_me");document.getElementById("logout_button").classList.remove("hide_me");
document.getElementById("full_menu_logout_button").classList.remove("hide_me");document.getElementById("log_in_message").classList.add("hide_me")}).catch(function(a){})}function logOut(){firebase.auth().signOut().then(function(){userID=!1;location.reload()}).catch(function(a){})}
function displayButtons(){if(listData||"myfavorites"!==listType)listData.user===userID&&"userlist"===listType?(document.getElementById("edit-button").classList.remove("hide_me"),hideClass("tag-search-only"),document.getElementById("add-album-button").classList.remove("hide_me"),document.getElementById("page-info-button").classList.remove("hide_me")):listData.user===userID&&"myfavorites"===listType?(document.getElementById("page-info-button").classList.remove("hide_me"),hideClass("list-only"),hideClass("tag-search-only"),
document.getElementById("edit-button").classList.add("hide_me"),document.getElementById("add-album-button").classList.remove("hide_me"),document.getElementById("share-favorites-button").classList.remove("hide_me")):(document.getElementById("page-info-button").classList.add("hide_me"),document.getElementById("edit-button").classList.add("hide_me"),document.getElementById("add-album-button").classList.add("hide_me"),hideClass("album-delete-button"));else{var a=document.getElementById("page-info-button");
a&&a.classList.add("hide_me");hideClass("tag-search-only");document.getElementById("edit-button").classList.add("hide_me");document.getElementById("add-album-button").classList.add("hide_me");hideClass("remove-if-no-albums");document.getElementById("share-favorites-button").classList.add("hide_me")}"favorites"===listType&&(document.getElementById("page-info-button").classList.remove("hide_me"),hideClass("list-and-favorites-only"),hideClass("tag-search-only"),hideClass("list-only"));if("tagsearch"===
listType&&(document.getElementById("page-info-button").classList.remove("hide_me"),showClass("tag-search-only"),hideClass("list-only"),hideClass("list-and-favorites-only"),1<document.getElementsByClassName("tagsearch-tag").length&&(a=!1,"ontouchstart"in document.documentElement&&(a=!0),!a))){a=document.querySelectorAll("[title]");for(var b=0;b<a.length;b++)new Tooltip(a[b],{placement:"top",animation:"hide",delay:10})}}document.getElementById("login_button").addEventListener("click",logIn);
document.getElementById("full_menu_login_button").addEventListener("click",logIn);document.getElementById("logout_button").addEventListener("click",logOut);document.getElementById("full_menu_logout_button").addEventListener("click",logOut);addClassEventListener("login_button","click",logIn);
document.addEventListener("DOMContentLoaded",function(){var a=!1;"ontouchstart"in document.documentElement&&(a=!0);a&&(a=document.getElementById("add-album-search-results"),a.style.paddingBottom="0px",a.style.overflowX="scroll",a=document.getElementById("favorites-search-results"),a.style.paddingBottom="0px",a.style.overflowX="scroll");a=document.querySelectorAll("#editListModal .nav-link");for(var b=0;b<a.length;b++)a[b].addEventListener("click",function(a){a.preventDefault();toggleActiveInfoTab(this.id)})});
