function truncate(a,b){a=a.substr(0,b-1);return a.substr(0,a.lastIndexOf(" ")).replace(/(^[,\s]+)|([,\s]+$)/g,"")+"..."}function executeSearch(a,b,c){var d=0;c&&1<c&&(d=25*(c-1));$.ajax({method:"GET",url:"/api/v1/apple/search/"+a,data:{offset:d},success:function(a){a.message?alert(a.messsage):"connection"===b?populateConnectionModalResults(a):"add to list"===b?populateAddToListModalResults(a):"add to favorites"===b?populateAddToFavoritesModalResults(a):populateSearchModalResults(a,c||1)}})}
function populateSearchModalResults(a,b){var c=0;!b||2>b?($("#search-modal-results").html(""),$("#searchModal .new-loader").hide()):(c=25*(b-1),$("#search-modal-placeholder").remove());if(a.albums&&0<a.albums.length){for(var d=0;d<a.albums.length;d++){var f=a.albums[d],e=d+c;createModalCard(e);populateModalCard(f,e)}$("#search-modal-results").append('<div id="search-modal-placeholder">&nbsp;</div>');25===a.albums.length&&(a=$("#search-modal-input").val().trim().replace(/[^\w\s]/gi,""),b++,addNextPageButton(a,
b))}else $("#search-modal-results").after('<div id="no-results-message" class="text-primary mb-3" style="text-align:center;">It looks like no albums matched your search terms. Try a different search!</div>')}
function addNextPageButton(a,b){$("#search-modal-results").append('<div class="align-self-center" id="next-page-button"><img src="/images/back_arrow.png" style="height:25px;cursor:pointer;transform:scaleX(-1);"></div>');$("#next-page-button").click(function(c){c.preventDefault();$("#next-page-button").remove();executeSearch(a,"next page",b)})}
function createModalCard(a){$("#search-modal-results").append('<div id="searchModalCard'+a+'" class="search-modal-card"><a class="search-modal-card-album-link" href=""><img class="search-modal-card-image" src="" alt=""><a/><div class="search-modal-card-body"><h4 class="search-modal-card-title"></h4><span class="search-modal-card-album"></span></div></div>')}
function populateModalCard(a,b){var c=a.artist,d=a.artist,f=a.title,e=a.title;32<c.length&&(c=truncate(c,32));44<f.length&&(f=truncate(f,44));49<d.length&&(d=truncate(d,49));66<e.length&&(e=truncate(e,66));$("#searchModalCard"+b+" .search-modal-card-title").html('<span class="search-modal-card-large-artist">'+d+'</span><span class="search-modal-card-small-artist">'+c+"</span>");$("#searchModalCard"+b+" .search-modal-card-album").html('<span class="search-modal-card-large-album">'+e+'</span><span class="search-modal-card-small-album">'+
f+"</span>");$("#searchModalCard"+b+" .search-modal-card-image").attr("src",a.cover.replace("{w}",260).replace("{h}",260));$("#searchModalCard"+b+" .search-modal-card-album-link").attr("href","/album/"+a.appleAlbumID)}$("#search-modal-button").click(function(a){a.preventDefault();a=$("#search-modal-input").val().trim().replace(/[^\w\s]/gi,"");$("#no-results-message").remove();$("#search-modal-results").html("");$("#searchModal .new-loader").show();executeSearch(a)});
$("#search-modal-input").keyup(function(a){13===a.keyCode&&$("#search-modal-button").click()});$(document).ready(function(){var a=!1;"ontouchstart"in document.documentElement&&(a=!0);a&&(a=document.getElementById("search-modal-results"),a.style.paddingBottom="0px",a.style.overflowX="scroll")});
