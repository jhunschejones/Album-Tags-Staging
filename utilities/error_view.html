<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B" crossorigin="anonymous">
    
        <title>Album Tags : Error Report</title>
    </head>
    <body>
        <div class="container-fluid">
            <h1>Album Tags Error Report</h1>
            <div id="error_results">
                <span id="loading_message" class="text-danger">Loading errors...</span>
            </div>
        </div>

    
        <!-- Optional JavaScript -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <!--script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script-->
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js" integrity="sha384-o+RDsa0aLu++PJvFqy8fFScvbHFLtbvScb8AjopnFD+iEQ7wo/CG0xlczd+2O/em" crossorigin="anonymous"></script>
        <script src="https://www.gstatic.com/firebasejs/4.12.0/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase-database.js"></script>
        
        <script>
            var config = {
                apiKey: "AIzaSyD1Hts7zVBvDXUf-sCb89hcPesJkrUKyUc",
                databaseURL: "https://album-tag-auth.firebaseio.com/",
                projectId: "album-tag-auth",
            };
            const defaultApp = firebase.initializeApp(config);

            firebase.database().ref('/errors').once('value').then(function(snapshot) {
                var stored_errors = snapshot.val();

                if (stored_errors.length < 1) {
                    
                    $('#loading_message').text("No errors at the moment!");
                } else {
                    var errors_messy = [];
                    var errors_to_display = [];
                    for (var key in stored_errors) {
                        // skip loop if the property is from prototype
                        if (!stored_errors.hasOwnProperty(key)) continue;

                        var obj = stored_errors[key];
                        for (var prop in obj) {
                            // skip loop if the property is from prototype
                            if(!obj.hasOwnProperty(prop)) continue;
                            
                            if(prop == "error") {
                                errors_messy.push([key, prop, obj[prop]])
                            }
                        }
                    }

                    for (let index = 0; index < errors_messy.length; index++) {
                        const element = errors_messy[index];
                        
                        let error_details = []
                        for (var key in element[2]) {

                            var obj = element[2][key];
                            error_details.push([key, obj])
                        }
                        errors_to_display.push([element[0], element[1], error_details])
                    }   

                    for (let index = 0; index < errors_to_display.length; index++) {
                        let element = errors_to_display[index];

                        $('#error_results').append(`<h4 class="accordian mt-2 mb-0" data-toggle="collapse" data-target="#collapse${element[0].substring(1)}" aria-expanded="true" aria-controls="collapse${element[0].substring(1)}">${element[1]} : <small class="text-secondary">${element[0].substring(1)}</small></h4>`)

                        $('#error_results').append(`<div id="collapse${element[0].substring(1)}" class="collapse" aria-labelledby="heading${element[0].substring(1)}">`)
                        
                        for (let index = 0; index < element[2].length; index++) {
                            const data = element[2][index];
                            $(`#collapse${element[0].substring(1)}`).append(`<span>${data[0]} : <span class="text-secondary">${data[1]}</span></span><br/>`)
                            if((index + 1) == element[2].length) {
                                $('#error_results').append('</div')
                            }
                        }
                    }  
                    $('#loading_message').hide();
                }
            });
        </script>
        
    </body>
</html>